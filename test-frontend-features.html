<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Frontend Features - Aplikasi Umroh</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            color: white;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
        }

        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e2e8f0;
        }

        .feature-icon {
            font-size: 2rem;
            margin-right: 15px;
        }

        .feature-title {
            font-size: 1.5rem;
            color: #2d3748;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #4a5568;
            font-weight: 500;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-top: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-1px);
            box-shadow: 0 4px 10px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-info {
            background: #4299e1;
            color: white;
        }

        .btn-warning {
            background: #ed8936;
            color: white;
        }

        .result-box {
            margin-top: 20px;
            padding: 15px;
            background: #f7fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .data-table {
            width: 100%;
            margin-top: 15px;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        .data-table th {
            background: #667eea;
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }

        .data-table tr:hover {
            background: #f7fafc;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-box input {
            flex: 1;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }

        .badge-success {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-warning {
            background: #fed7aa;
            color: #92400e;
        }

        .badge-error {
            background: #fee2e2;
            color: #991b1b;
        }

        .badge-info {
            background: #dbeafe;
            color: #1e40af;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            color: #718096;
            font-size: 0.875rem;
            margin-top: 5px;
        }

        .tab-container {
            margin-bottom: 20px;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #e2e8f0;
        }

        .tab-button {
            padding: 10px 20px;
            background: none;
            border: none;
            color: #718096;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button.active {
            color: #667eea;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        .tab-content {
            padding: 20px 0;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .file-upload {
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #667eea;
            background: #f7fafc;
        }

        .file-upload.dragover {
            border-color: #667eea;
            background: #ebf4ff;
        }

        @media (max-width: 768px) {
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Frontend Feature Tester</h1>

        <div class="feature-grid">
            <!-- Login Test -->
            <div class="feature-card">
                <div class="feature-header">
                    <div class="feature-icon">üîê</div>
                    <div class="feature-title">Login & Authentication</div>
                </div>
                <form id="loginForm">
                    <div class="form-group">
                        <label>Username</label>
                        <input type="text" id="loginUsername" value="admin" required>
                    </div>
                    <div class="form-group">
                        <label>Password</label>
                        <input type="password" id="loginPassword" value="admin123" required>
                    </div>
                    <button type="submit" class="btn-primary">Login</button>
                    <button type="button" class="btn-info" onclick="checkAuth()">Check Auth</button>
                    <button type="button" class="btn-warning" onclick="logout()">Logout</button>
                </form>
                <div id="loginResult" class="result-box"></div>
            </div>

            <!-- Jamaah Management -->
            <div class="feature-card">
                <div class="feature-header">
                    <div class="feature-icon">üë•</div>
                    <div class="feature-title">Jamaah Management</div>
                </div>
                <div class="search-box">
                    <input type="text" id="jamaahSearch" placeholder="Cari jamaah...">
                    <button class="btn-primary" onclick="searchJamaah()">Search</button>
                </div>
                <form id="jamaahForm">
                    <div class="form-group">
                        <label>Nama Lengkap</label>
                        <input type="text" id="jamaahName" required>
                    </div>
                    <div class="form-group">
                        <label>NIK</label>
                        <input type="text" id="jamaahNIK" maxlength="16" required>
                    </div>
                    <div class="form-group">
                        <label>No. HP</label>
                        <input type="tel" id="jamaahPhone" required>
                    </div>
                    <button type="submit" class="btn-success">Tambah Jamaah</button>
                    <button type="button" class="btn-primary" onclick="listJamaah()">List Jamaah</button>
                </form>
                <div id="jamaahResult" class="result-box"></div>
            </div>

            <!-- Package Management -->
            <div class="feature-card">
                <div class="feature-header">
                    <div class="feature-icon">üì¶</div>
                    <div class="feature-title">Package Management</div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalPackages">0</div>
                        <div class="stat-label">Total Packages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="activePackages">0</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalQuota">0</div>
                        <div class="stat-label">Total Quota</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="availableQuota">0</div>
                        <div class="stat-label">Available</div>
                    </div>
                </div>
                <button class="btn-primary" onclick="loadPackages()">Load Packages</button>
                <button class="btn-success" onclick="showCreatePackage()">Create Package</button>
                <div id="packageResult" class="result-box"></div>
            </div>

            <!-- Payment Management -->
            <div class="feature-card">
                <div class="feature-header">
                    <div class="feature-icon">üí∞</div>
                    <div class="feature-title">Payment Management</div>
                </div>
                <form id="paymentForm">
                    <div class="form-group">
                        <label>Jamaah</label>
                        <select id="paymentJamaah">
                            <option value="">-- Pilih Jamaah --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Jumlah Pembayaran</label>
                        <input type="number" id="paymentAmount" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Metode Pembayaran</label>
                        <select id="paymentMethod">
                            <option value="transfer">Transfer Bank</option>
                            <option value="cash">Cash</option>
                            <option value="credit">Kartu Kredit</option>
                        </select>
                    </div>
                    <button type="submit" class="btn-success">Simpan Pembayaran</button>
                    <button type="button" class="btn-primary" onclick="listPayments()">List Payments</button>
                </form>
                <div id="paymentResult" class="result-box"></div>
            </div>

            <!-- Document Upload -->
            <div class="feature-card">
                <div class="feature-header">
                    <div class="feature-icon">üìÑ</div>
                    <div class="feature-title">Document Upload</div>
                </div>
                <div class="file-upload" id="dropZone">
                    <p>üìÅ Drag & drop files here or click to browse</p>
                    <input type="file" id="fileInput" multiple style="display: none;">
                </div>
                <div class="form-group" style="margin-top: 15px;">
                    <label>Document Type</label>
                    <select id="documentType">
                        <option value="passport">Passport</option>
                        <option value="ktp">KTP</option>
                        <option value="photo">Foto</option>
                        <option value="medical">Surat Kesehatan</option>
                        <option value="other">Lainnya</option>
                    </select>
                </div>
                <button class="btn-primary" onclick="uploadDocuments()">Upload Documents</button>
                <button class="btn-info" onclick="listDocuments()">List Documents</button>
                <div id="documentResult" class="result-box"></div>
            </div>

            <!-- Reports & Analytics -->
            <div class="feature-card">
                <div class="feature-header">
                    <div class="feature-icon">üìä</div>
                    <div class="feature-title">Reports & Analytics</div>
                </div>
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchTab('summary')">Summary</button>
                        <button class="tab-button" onclick="switchTab('jamaah')">Jamaah</button>
                        <button class="tab-button" onclick="switchTab('finance')">Finance</button>
                        <button class="tab-button" onclick="switchTab('package')">Package</button>
                    </div>
                    <div class="tab-content">
                        <div class="tab-pane active" id="summaryTab">
                            <button class="btn-primary" onclick="loadSummaryReport()">Load Summary</button>
                        </div>
                        <div class="tab-pane" id="jamaahTab">
                            <button class="btn-primary" onclick="loadJamaahReport()">Load Jamaah Report</button>
                        </div>
                        <div class="tab-pane" id="financeTab">
                            <button class="btn-primary" onclick="loadFinanceReport()">Load Finance Report</button>
                        </div>
                        <div class="tab-pane" id="packageTab">
                            <button class="btn-primary" onclick="loadPackageReport()">Load Package Report</button>
                        </div>
                    </div>
                </div>
                <div id="reportResult" class="result-box"></div>
            </div>

            <!-- Excel Import/Export -->
            <div class="feature-card">
                <div class="feature-header">
                    <div class="feature-icon">üìë</div>
                    <div class="feature-title">Excel Import/Export</div>
                </div>
                <div class="form-group">
                    <label>Export Type</label>
                    <select id="exportType">
                        <option value="jamaah">Data Jamaah</option>
                        <option value="payments">Data Pembayaran</option>
                        <option value="packages">Data Paket</option>
                        <option value="manifest">Manifest Keberangkatan</option>
                    </select>
                </div>
                <button class="btn-success" onclick="exportToExcel()">Export to Excel</button>
                <button class="btn-info" onclick="downloadTemplate()">Download Template</button>
                <div class="form-group" style="margin-top: 20px;">
                    <label>Import Excel</label>
                    <input type="file" id="excelFile" accept=".xlsx,.xls">
                </div>
                <button class="btn-warning" onclick="importFromExcel()">Import from Excel</button>
                <div id="excelResult" class="result-box"></div>
            </div>

            <!-- Notification System -->
            <div class="feature-card">
                <div class="feature-header">
                    <div class="feature-icon">üîî</div>
                    <div class="feature-title">Notification System</div>
                </div>
                <button class="btn-primary" onclick="showNotification('info', 'Test Info Notification')">
                    Info Notification
                </button>
                <button class="btn-success" onclick="showNotification('success', 'Test Success Notification')">
                    Success Notification
                </button>
                <button class="btn-warning" onclick="showNotification('warning', 'Test Warning Notification')">
                    Warning Notification
                </button>
                <button class="btn-primary" onclick="listNotifications()" style="background: #f56565;">
                    List All Notifications
                </button>
                <div id="notificationResult" class="result-box"></div>
            </div>

            <!-- Search & Filter -->
            <div class="feature-card">
                <div class="feature-header">
                    <div class="feature-icon">üîç</div>
                    <div class="feature-title">Advanced Search</div>
                </div>
                <form id="searchForm">
                    <div class="form-group">
                        <label>Search Type</label>
                        <select id="searchType">
                            <option value="jamaah">Jamaah</option>
                            <option value="payment">Payment</option>
                            <option value="package">Package</option>
                            <option value="document">Document</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Search Query</label>
                        <input type="text" id="searchQuery" placeholder="Enter search term...">
                    </div>
                    <div class="form-group">
                        <label>Date Range</label>
                        <input type="date" id="dateFrom" style="width: 48%; display: inline-block;">
                        <input type="date" id="dateTo" style="width: 48%; display: inline-block; float: right;">
                    </div>
                    <button type="submit" class="btn-primary">Search</button>
                    <button type="button" class="btn-info" onclick="clearSearch()">Clear</button>
                </form>
                <div id="searchResult" class="result-box"></div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_URL = 'http://localhost:5000/api';
        let authToken = localStorage.getItem('authToken') || '';

        // Utility Functions
        function showResult(elementId, content, isError = false) {
            const element = document.getElementById(elementId);
            element.style.display = 'block';
            element.innerHTML = content;
            element.style.borderColor = isError ? '#f56565' : '#48bb78';
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR'
            }).format(amount);
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString('id-ID', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }

        // API Request Helper
        async function apiRequest(endpoint, options = {}) {
            try {
                const response = await fetch(`${API_URL}${endpoint}`, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`,
                        ...options.headers
                    }
                });

                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('API Error:', error);
                throw error;
            }
        }

        // Authentication Functions
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const data = await apiRequest('/auth/login', {
                    method: 'POST',
                    body: JSON.stringify({
                        username: document.getElementById('loginUsername').value,
                        password: document.getElementById('loginPassword').value
                    })
                });
                
                authToken = data.token;
                localStorage.setItem('authToken', authToken);
                
                showResult('loginResult', `
                    <strong>‚úÖ Login Successful!</strong><br>
                    User: ${data.user.username}<br>
                    Role: ${data.user.role}<br>
                    Token: ${authToken.substring(0, 20)}...
                `);
            } catch (error) {
                showResult('loginResult', `‚ùå Login Failed: ${error.message}`, true);
            }
        });

        function checkAuth() {
            if (authToken) {
                showResult('loginResult', `
                    <strong>üîë Auth Status:</strong><br>
                    Token exists: Yes<br>
                    Token: ${authToken.substring(0, 20)}...
                `);
            } else {
                showResult('loginResult', '‚ùå Not authenticated', true);
            }
        }

        function logout() {
            authToken = '';
            localStorage.removeItem('authToken');
            showResult('loginResult', '‚úÖ Logged out successfully');
        }

        // Jamaah Functions
        document.getElementById('jamaahForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const data = await apiRequest('/jamaah', {
                    method: 'POST',
                    body: JSON.stringify({
                        full_name: document.getElementById('jamaahName').value,
                        nik: document.getElementById('jamaahNIK').value,
                        phone: document.getElementById('jamaahPhone').value,
                        birth_date: '1990-01-01',
                        gender: 'L',
                        address: 'Test Address'
                    })
                });
                
                showResult('jamaahResult', `
                    <strong>‚úÖ Jamaah Created!</strong><br>
                    ID: ${data.jamaah.id}<br>
                    Name: ${data.jamaah.full_name}<br>
                    NIK: ${data.jamaah.nik}
                `);
                
                // Update payment select
                updateJamaahSelect();
            } catch (error) {
                showResult('jamaahResult', `‚ùå Error: ${error.message}`, true);
            }
        });

        async function listJamaah() {
            try {
                const data = await apiRequest('/jamaah');
                
                let html = '<h4>Jamaah List</h4>';
                html += '<table class="data-table">';
                html += '<tr><th>Name</th><th>NIK</th><th>Phone</th><th>Status</th></tr>';
                
                data.jamaah.forEach(j => {
                    html += `<tr>
                        <td>${j.full_name}</td>
                        <td>${j.nik}</td>
                        <td>${j.phone}</td>
                        <td><span class="status-badge badge-${j.status === 'active' ? 'success' : 'warning'}">${j.status}</span></td>
                    </tr>`;
                });
                
                html += '</table>';
                showResult('jamaahResult', html);
            } catch (error) {
                showResult('jamaahResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function searchJamaah() {
            const query = document.getElementById('jamaahSearch').value;
            try {
                const data = await apiRequest(`/jamaah?search=${encodeURIComponent(query)}`);
                
                let html = `<h4>Search Results (${data.jamaah.length})</h4>`;
                if (data.jamaah.length > 0) {
                    html += '<table class="data-table">';
                    html += '<tr><th>Name</th><th>NIK</th><th>Phone</th></tr>';
                    
                    data.jamaah.forEach(j => {
                        html += `<tr>
                            <td>${j.full_name}</td>
                            <td>${j.nik}</td>
                            <td>${j.phone}</td>
                        </tr>`;
                    });
                    
                    html += '</table>';
                } else {
                    html += '<p>No results found</p>';
                }
                
                showResult('jamaahResult', html);
            } catch (error) {
                showResult('jamaahResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        // Package Functions
        async function loadPackages() {
            try {
                const data = await apiRequest('/packages');
                
                // Update stats
                document.getElementById('totalPackages').textContent = data.packages.length;
                document.getElementById('activePackages').textContent = data.packages.filter(p => p.is_active).length;
                document.getElementById('totalQuota').textContent = data.packages.reduce((sum, p) => sum + p.quota, 0);
                document.getElementById('availableQuota').textContent = data.packages.reduce((sum, p) => sum + p.available_quota, 0);
                
                let html = '<h4>Package List</h4>';
                html += '<table class="data-table">';
                html += '<tr><th>Name</th><th>Price</th><th>Departure</th><th>Quota</th><th>Tier</th></tr>';
                
                data.packages.forEach(p => {
                    html += `<tr>
                        <td>${p.name}</td>
                        <td>${formatCurrency(p.price)}</td>
                        <td>${formatDate(p.departure_date)}</td>
                        <td>${p.available_quota}/${p.quota}</td>
                        <td><span class="status-badge badge-info">${p.tier}</span></td>
                    </tr>`;
                });
                
                html += '</table>';
                showResult('packageResult', html);
            } catch (error) {
                showResult('packageResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        function showCreatePackage() {
            const html = `
                <h4>Create New Package</h4>
                <form onsubmit="createPackage(event)">
                    <div class="form-group">
                        <label>Package Name</label>
                        <input type="text" id="newPackageName" required>
                    </div>
                    <div class="form-group">
                        <label>Price</label>
                        <input type="number" id="newPackagePrice" min="0" required>
                    </div>
                    <div class="form-group">
                        <label>Quota</label>
                        <input type="number" id="newPackageQuota" min="1" required>
                    </div>
                    <button type="submit" class="btn-success">Create Package</button>
                </form>
            `;
            showResult('packageResult', html);
        }

        async function createPackage(event) {
            event.preventDefault();
            
            try {
                const data = await apiRequest('/packages', {
                    method: 'POST',
                    body: JSON.stringify({
                        name: document.getElementById('newPackageName').value,
                        price: parseInt(document.getElementById('newPackagePrice').value),
                        quota: parseInt(document.getElementById('newPackageQuota').value),
                        available_quota: parseInt(document.getElementById('newPackageQuota').value),
                        duration: 9,
                        departure_date: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        tier: 'gold'
                    })
                });
                
                showResult('packageResult', `‚úÖ Package created: ${data.package.name}`);
                loadPackages();
            } catch (error) {
                showResult('packageResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        // Payment Functions
        async function updateJamaahSelect() {
            try {
                const data = await apiRequest('/jamaah');
                const select = document.getElementById('paymentJamaah');
                
                select.innerHTML = '<option value="">-- Pilih Jamaah --</option>';
                data.jamaah.forEach(j => {
                    select.innerHTML += `<option value="${j.id}">${j.full_name} - ${j.nik}</option>`;
                });
            } catch (error) {
                console.error('Error loading jamaah:', error);
            }
        }

        document.getElementById('paymentForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            try {
                const data = await apiRequest('/payments', {
                    method: 'POST',
                    body: JSON.stringify({
                        jamaah_id: document.getElementById('paymentJamaah').value,
                        amount: parseInt(document.getElementById('paymentAmount').value),
                        payment_method: document.getElementById('paymentMethod').value,
                        payment_date: new Date().toISOString()
                    })
                });
                
                showResult('paymentResult', `
                    <strong>‚úÖ Payment Recorded!</strong><br>
                    Payment Code: ${data.payment.payment_code}<br>
                    Amount: ${formatCurrency(data.payment.amount)}<br>
                    Method: ${data.payment.payment_method}
                `);
            } catch (error) {
                showResult('paymentResult', `‚ùå Error: ${error.message}`, true);
            }
        });

        async function listPayments() {
            try {
                const data = await apiRequest('/payments');
                
                let html = '<h4>Payment List</h4>';
                html += '<table class="data-table">';
                html += '<tr><th>Code</th><th>Jamaah</th><th>Amount</th><th>Date</th><th>Status</th></tr>';
                
                data.payments.forEach(p => {
                    html += `<tr>
                        <td>${p.payment_code}</td>
                        <td>${p.jamaah_name || 'N/A'}</td>
                        <td>${formatCurrency(p.amount)}</td>
                        <td>${formatDate(p.payment_date)}</td>
                        <td><span class="status-badge badge-${p.status === 'verified' ? 'success' : 'warning'}">${p.status}</span></td>
                    </tr>`;
                });
                
                html += '</table>';
                showResult('paymentResult', html);
            } catch (error) {
                showResult('paymentResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        // Document Functions
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        dropZone.addEventListener('click', () => fileInput.click());
        
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            fileInput.files = e.dataTransfer.files;
        });

        async function uploadDocuments() {
            const files = fileInput.files;
            if (files.length === 0) {
                showResult('documentResult', '‚ùå Please select files to upload', true);
                return;
            }
            
            const formData = new FormData();
            for (let file of files) {
                formData.append('files', file);
            }
            formData.append('document_type', document.getElementById('documentType').value);
            
            try {
                const response = await fetch(`${API_URL}/documents/upload`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('documentResult', `‚úÖ Uploaded ${data.files.length} files successfully`);
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                showResult('documentResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function listDocuments() {
            try {
                const data = await apiRequest('/documents');
                
                let html = '<h4>Document List</h4>';
                html += '<table class="data-table">';
                html += '<tr><th>Name</th><th>Type</th><th>Upload Date</th><th>Status</th></tr>';
                
                data.documents.forEach(d => {
                    html += `<tr>
                        <td>${d.document_name}</td>
                        <td>${d.document_type}</td>
                        <td>${formatDate(d.upload_date)}</td>
                        <td><span class="status-badge badge-${d.is_verified ? 'success' : 'warning'}">
                            ${d.is_verified ? 'Verified' : 'Pending'}
                        </span></td>
                    </tr>`;
                });
                
                html += '</table>';
                showResult('documentResult', html);
            } catch (error) {
                showResult('documentResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        // Report Functions
        function switchTab(tabName) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-pane').forEach(pane => pane.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(`${tabName}Tab`).classList.add('active');
        }

        async function loadSummaryReport() {
            try {
                const data = await apiRequest('/reports/summary');
                
                let html = '<h4>Summary Report</h4>';
                html += `
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${data.total_jamaah || 0}</div>
                            <div class="stat-label">Total Jamaah</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.total_packages || 0}</div>
                            <div class="stat-label">Total Packages</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${formatCurrency(data.total_revenue || 0)}</div>
                            <div class="stat-label">Total Revenue</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${data.pending_payments || 0}</div>
                            <div class="stat-label">Pending Payments</div>
                        </div>
                    </div>
                `;
                
                showResult('reportResult', html);
            } catch (error) {
                showResult('reportResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function loadJamaahReport() {
            try {
                const data = await apiRequest('/reports/jamaah');
                
                let html = '<h4>Jamaah Report</h4>';
                html += `<p>Total: ${data.total} jamaah</p>`;
                html += '<canvas id="jamaahChart" width="400" height="200"></canvas>';
                
                showResult('reportResult', html);
                
                // Simple chart visualization
                // In real app, use Chart.js or similar
            } catch (error) {
                showResult('reportResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function loadFinanceReport() {
            try {
                const data = await apiRequest('/reports/finance');
                
                let html = '<h4>Finance Report</h4>';
                html += `
                    <p>Total Revenue: ${formatCurrency(data.total_revenue || 0)}</p>
                    <p>Total Collected: ${formatCurrency(data.total_collected || 0)}</p>
                    <p>Outstanding: ${formatCurrency(data.outstanding || 0)}</p>
                `;
                
                showResult('reportResult', html);
            } catch (error) {
                showResult('reportResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function loadPackageReport() {
            try {
                const data = await apiRequest('/reports/packages');
                
                let html = '<h4>Package Report</h4>';
                html += '<table class="data-table">';
                html += '<tr><th>Package</th><th>Sold</th><th>Available</th><th>Revenue</th></tr>';
                
                if (data.packages) {
                    data.packages.forEach(p => {
                        html += `<tr>
                            <td>${p.name}</td>
                            <td>${p.sold}</td>
                            <td>${p.available}</td>
                            <td>${formatCurrency(p.revenue)}</td>
                        </tr>`;
                    });
                }
                
                html += '</table>';
                showResult('reportResult', html);
            } catch (error) {
                showResult('reportResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        // Excel Functions
        async function exportToExcel() {
            const type = document.getElementById('exportType').value;
            
            try {
                const response = await fetch(`${API_URL}/excel/export/${type}`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `${type}_export_${Date.now()}.xlsx`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    showResult('excelResult', `‚úÖ Export successful: ${type}`);
                } else {
                    throw new Error('Export failed');
                }
            } catch (error) {
                showResult('excelResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function downloadTemplate() {
            try {
                const response = await fetch(`${API_URL}/excel/template/jamaah`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'jamaah_template.xlsx';
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);
                    
                    showResult('excelResult', '‚úÖ Template downloaded');
                } else {
                    throw new Error('Download failed');
                }
            } catch (error) {
                showResult('excelResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        async function importFromExcel() {
            const file = document.getElementById('excelFile').files[0];
            if (!file) {
                showResult('excelResult', '‚ùå Please select a file', true);
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const response = await fetch(`${API_URL}/excel/import/jamaah`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('excelResult', `
                        ‚úÖ Import successful!<br>
                        Imported: ${data.imported}<br>
                        Skipped: ${data.skipped}<br>
                        Errors: ${data.errors}
                    `);
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                showResult('excelResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        // Notification Functions
        function showNotification(type, message) {
            // In real app, use a proper notification library
            const colors = {
                info: '#4299e1',
                success: '#48bb78',
                warning: '#ed8936',
                error: '#f56565'
            };
            
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${colors[type]};
                color: white;
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 10px rgba(0,0,0,0.2);
                z-index: 1000;
                animation: slideIn 0.3s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }

        async function listNotifications() {
            try {
                const data = await apiRequest('/notifications');
                
                let html = '<h4>Notifications</h4>';
                if (data.notifications && data.notifications.length > 0) {
                    data.notifications.forEach(n => {
                        html += `
                            <div style="padding: 10px; margin: 5px 0; background: #f7fafc; border-radius: 5px;">
                                <strong>${n.title}</strong><br>
                                ${n.message}<br>
                                <small>${new Date(n.created_at).toLocaleString()}</small>
                            </div>
                        `;
                    });
                } else {
                    html += '<p>No notifications</p>';
                }
                
                showResult('notificationResult', html);
            } catch (error) {
                showResult('notificationResult', `‚ùå Error: ${error.message}`, true);
            }
        }

        // Search Functions
        document.getElementById('searchForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const type = document.getElementById('searchType').value;
            const query = document.getElementById('searchQuery').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            let endpoint = `/${type}?search=${encodeURIComponent(query)}`;
            if (dateFrom) endpoint += `&from=${dateFrom}`;
            if (dateTo) endpoint += `&to=${dateTo}`;
            
            try {
                const data = await apiRequest(endpoint);
                
                let html = `<h4>Search Results</h4>`;
                html += `<p>Found ${data[type].length} results</p>`;
                
                // Display results based on type
                if (data[type].length > 0) {
                    html += '<table class="data-table">';
                    // Table headers based on type
                    html += '</table>';
                }
                
                showResult('searchResult', html);
            } catch (error) {
                showResult('searchResult', `‚ùå Error: ${error.message}`, true);
            }
        });

        function clearSearch() {
            document.getElementById('searchForm').reset();
            document.getElementById('searchResult').style.display = 'none';
        }

        // Initialize on load
        window.onload = () => {
            updateJamaahSelect();
            
            // Add CSS animations
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
                @keyframes slideOut {
                    from { transform: translateX(0); opacity: 1; }
                    to { transform: translateX(100%); opacity: 0; }
                }
            `;
            document.head.appendChild(style);
        };
    </script>
</body>
</html>