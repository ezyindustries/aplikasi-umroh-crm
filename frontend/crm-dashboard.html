<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM Dashboard - Vauza Tamma Marketing</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <link rel="shortcut icon" href="favicon.svg">
    
    <!-- Material UI Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Custom CSS -->
    <!-- <link rel="stylesheet" href="css/style.css"> -->
    
    <style>
        /* Global Styles from style.css */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #475569 75%, #64748b 100%);
            min-height: 100vh;
            color: #f8fafc;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            z-index: -1;
        }

        /* Main App Container */
        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.9));
            backdrop-filter: blur(20px);
            border-right: 1px solid rgba(71, 85, 105, 0.3);
            padding: 20px;
            overflow-y: auto;
            box-shadow: 
                inset 0 1px 0 rgba(71, 85, 105, 0.4),
                0 20px 40px rgba(0, 0, 0, 0.3),
                0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .logo {
            text-align: center;
            background: linear-gradient(135deg, #3b82f6, #10b981, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 30px;
            padding: 20px 0;
            text-shadow: 0 2px 10px rgba(59, 130, 246, 0.3);
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            margin: 5px 0;
            border-radius: 12px;
            color: #e2e8f0;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            background: linear-gradient(135deg, rgba(71, 85, 105, 0.4), rgba(30, 41, 59, 0.3));
            border: 1px solid rgba(71, 85, 105, 0.3);
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .nav-item:hover::before {
            left: 100%;
        }

        .nav-item:hover {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(16, 185, 129, 0.2));
            transform: translateX(5px);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .nav-item.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.4), rgba(16, 185, 129, 0.3));
            border-color: rgba(59, 130, 246, 0.6);
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .nav-item i, .nav-item .material-icons {
            margin-right: 12px;
            font-size: 20px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }

        /* Header */
        .header {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.7));
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(71, 85, 105, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        /* Content Pages */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Search Box */
        .search-box {
            flex: 1;
            max-width: 400px;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(71, 85, 105, 0.4);
            border-radius: 12px;
            color: #e2e8f0;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        }
        
        .search-box i, .search-box .material-icons {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .notification-btn {
            position: relative;
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid rgba(71, 85, 105, 0.4);
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .notification-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: linear-gradient(135deg, #ef4444, #f87171);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: 600;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid rgba(71, 85, 105, 0.4);
            border-radius: 12px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .user-profile:hover {
            background: rgba(71, 85, 105, 0.4);
            border-color: rgba(71, 85, 105, 0.6);
        }
        
        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: white;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.6));
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(255, 255, 255, 0.05));
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .stat-card:hover::before {
            opacity: 1;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                0 0 60px rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 16px;
        }
        
        .stat-icon.blue {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.2));
            color: #60a5fa;
        }
        
        .stat-icon.green {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.2));
            color: #34d399;
        }
        
        .stat-icon.purple {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.3), rgba(124, 58, 237, 0.2));
            color: #a78bfa;
        }
        
        .stat-icon.orange {
            background: linear-gradient(135deg, rgba(251, 146, 60, 0.3), rgba(249, 115, 22, 0.2));
            color: #fb923c;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 8px;
            background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stat-label {
            color: #94a3b8;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* Chart Container */
        .chart-container {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.6));
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            margin-bottom: 30px;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        /* Tables */
        .table-container {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.6));
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            margin-bottom: 30px;
            overflow: hidden;
        }
        
        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .table-title {
            font-size: 18px;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .table-actions {
            display: flex;
            gap: 12px;
        }
        
        .table-wrapper {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            text-align: left;
            padding: 12px 16px;
            font-weight: 600;
            font-size: 13px;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
            white-space: nowrap;
        }
        
        td {
            padding: 16px;
            color: #e2e8f0;
            font-size: 14px;
            border-bottom: 1px solid rgba(71, 85, 105, 0.2);
        }
        
        tr:hover td {
            background: rgba(71, 85, 105, 0.2);
        }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }
        
        .btn-secondary {
            background: rgba(71, 85, 105, 0.4);
            color: #e2e8f0;
            border: 1px solid rgba(71, 85, 105, 0.5);
        }
        
        .btn-secondary:hover:not(:disabled) {
            background: rgba(71, 85, 105, 0.6);
            border-color: rgba(71, 85, 105, 0.7);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        label, .form-label {
            display: block;
            margin-bottom: 8px;
            color: #cbd5e1;
            font-weight: 500;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        input[type="tel"],
        input[type="number"],
        select,
        textarea,
        .form-control {
            width: 100%;
            padding: 12px 16px;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(71, 85, 105, 0.4);
            border-radius: 10px;
            color: #e2e8f0;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }
        
        input[type="text"]:focus,
        input[type="email"]:focus,
        input[type="password"]:focus,
        input[type="date"]:focus,
        input[type="tel"]:focus,
        input[type="number"]:focus,
        select:focus,
        textarea:focus,
        .form-control:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            background: rgba(15, 23, 42, 0.7);
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.9));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(71, 85, 105, 0.3);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.4);
        }
        
        .modal-header {
            padding: 24px;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #e2e8f0;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: #94a3b8;
            font-size: 24px;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: #e2e8f0;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            padding: 24px;
            border-top: 1px solid rgba(71, 85, 105, 0.3);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        /* Badges */
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .badge-warning {
            background: rgba(251, 146, 60, 0.2);
            color: #fb923c;
            border: 1px solid rgba(251, 146, 60, 0.3);
        }
        
        .badge-danger {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .badge-info {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                position: fixed;
                left: -280px;
                height: 100vh;
                z-index: 100;
                transition: left 0.3s;
            }
        
            .sidebar.active {
                left: 0;
            }
        
            .main-content {
                padding: 20px;
            }
        
            .stats-grid {
                grid-template-columns: 1fr;
            }
        
            .header {
                flex-direction: column;
                gap: 15px;
            }
        
            .search-box {
                max-width: 100%;
            }
            
            .table-wrapper {
                margin: 0 -20px;
                padding: 0 20px;
            }
        }

        /* CRM Specific Styles */
        .crm-header {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .funnel-stage {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.6));
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(71, 85, 105, 0.3);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .funnel-stage:hover {
            transform: translateY(-5px);
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        }
        
        .funnel-value {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .funnel-label {
            color: #94a3b8;
            font-size: 14px;
        }
        
        .conversation-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid rgba(71, 85, 105, 0.2);
            transition: background 0.3s;
        }
        
        .conversation-item:hover {
            background: rgba(71, 85, 105, 0.2);
        }
        
        .conversation-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: 600;
            color: white;
        }
        
        .conversation-details {
            flex: 1;
        }
        
        .conversation-name {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .conversation-preview {
            color: #94a3b8;
            font-size: 13px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 300px;
        }
        
        .conversation-time {
            color: #64748b;
            font-size: 12px;
        }
        
        .bot-status {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .bot-status.active {
            background: rgba(16, 185, 129, 0.2);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .bot-status.inactive {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .lead-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.7), rgba(15, 23, 42, 0.6));
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            margin-bottom: 15px;
            transition: all 0.3s;
        }
        
        .lead-card:hover {
            transform: translateX(5px);
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .lead-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .lead-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .lead-tag {
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
        }
        
        .hot-lead {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .warm-lead {
            background: rgba(251, 146, 60, 0.2);
            color: #fb923c;
            border: 1px solid rgba(251, 146, 60, 0.3);
        }
        
        .cold-lead {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        /* WhatsApp Chat Style */
        .chat-container {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.8));
            border-radius: 16px;
            height: 600px;
            display: flex;
            flex-direction: column;
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
        
        .chat-header {
            padding: 20px;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .message {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 14px;
            line-height: 1.5;
        }
        
        .message.inbound {
            align-self: flex-start;
            background: rgba(71, 85, 105, 0.3);
            border-bottom-left-radius: 4px;
        }
        
        .message.outbound {
            align-self: flex-end;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(37, 99, 235, 0.2));
            border-bottom-right-radius: 4px;
        }
        
        .message.bot {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.3), rgba(5, 150, 105, 0.2));
        }
        
        .message-time {
            font-size: 11px;
            color: #64748b;
            margin-top: 4px;
        }
        
        .chat-input {
            padding: 20px;
            border-top: 1px solid rgba(71, 85, 105, 0.3);
            display: flex;
            gap: 10px;
        }
        
        .chat-input input {
            flex: 1;
        }
        
        /* Bot Config Modal */
        .config-section {
            margin-bottom: 30px;
        }
        
        .config-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #e2e8f0;
        }
        
        .template-item {
            background: rgba(71, 85, 105, 0.2);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
        }
        
        .template-keywords {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        
        .keyword-chip {
            background: rgba(59, 130, 246, 0.2);
            color: #60a5fa;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
        }
        
        /* Fix for chart sizing */
        .chart-container {
            position: relative;
            height: 300px;
            min-height: 300px;
            max-height: 400px;
        }
        
        .chart-container canvas {
            max-width: 100% !important;
            height: auto !important;
            max-height: 300px !important;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
            border-radius: 16px;
            padding: 24px;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(71, 85, 105, 0.3);
        }
    </style>
</head>
<body>
    <div class="app-container" style="display: flex;">
        <!-- Sidebar (reuse from main app) -->
        <div class="sidebar">
            <div class="logo">CRM Dashboard</div>
            
            <nav>
                <div class="nav-item active" onclick="switchCRMPage('overview')">
                    <span class="material-icons">dashboard</span>
                    <span>Overview</span>
                </div>
                <div class="nav-item" onclick="switchCRMPage('leads')">
                    <span class="material-icons">people</span>
                    <span>Leads</span>
                </div>
                <div class="nav-item" onclick="switchCRMPage('conversations')">
                    <span class="material-icons">chat</span>
                    <span>WhatsApp</span>
                </div>
                <div class="nav-item" onclick="switchCRMPage('campaigns')">
                    <span class="material-icons">campaign</span>
                    <span>Campaigns</span>
                </div>
                <div class="nav-item" onclick="switchCRMPage('bot-config')">
                    <span class="material-icons">smart_toy</span>
                    <span>AI Bot Config</span>
                </div>
                <div class="nav-item" onclick="switchCRMPage('analytics')">
                    <span class="material-icons">analytics</span>
                    <span>Analytics</span>
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <div class="header">
                <h2 style="font-size: 24px; font-weight: 700;">Marketing CRM Dashboard</h2>
                <div class="header-actions">
                    <div class="bot-status active">
                        <span class="material-icons" style="font-size: 16px;">smart_toy</span>
                        <span>Bot Active</span>
                    </div>
                    <button class="btn btn-primary" onclick="openNewLeadModal()">
                        <span class="material-icons">add</span> New Lead
                    </button>
                </div>
            </div>

            <!-- Overview Page -->
            <div class="page active" id="overview-page">
                <!-- CRM Metrics Header -->
                <div class="crm-header">
                    <h3 style="font-size: 20px; margin-bottom: 20px;">Marketing Performance</h3>
                    <div class="stats-grid" style="grid-template-columns: repeat(5, 1fr);">
                        <div class="stat-card" style="background: transparent; box-shadow: none; padding: 0;">
                            <div class="stat-label">Total Leads</div>
                            <div class="stat-value" id="total-leads">247</div>
                            <div style="color: #10b981; font-size: 12px;">+12% vs last month</div>
                        </div>
                        <div class="stat-card" style="background: transparent; box-shadow: none; padding: 0;">
                            <div class="stat-label">Active Conversations</div>
                            <div class="stat-value" id="active-convos">18</div>
                            <div style="color: #3b82f6; font-size: 12px;">5 handled by bot</div>
                        </div>
                        <div class="stat-card" style="background: transparent; box-shadow: none; padding: 0;">
                            <div class="stat-label">Conversion Rate</div>
                            <div class="stat-value">12.4%</div>
                            <div style="color: #10b981; font-size: 12px;">+2.1% vs last month</div>
                        </div>
                        <div class="stat-card" style="background: transparent; box-shadow: none; padding: 0;">
                            <div class="stat-label">Avg Response Time</div>
                            <div class="stat-value">2.3m</div>
                            <div style="color: #f59e0b; font-size: 12px;">Bot: 5s</div>
                        </div>
                        <div class="stat-card" style="background: transparent; box-shadow: none; padding: 0;">
                            <div class="stat-label">Revenue Pipeline</div>
                            <div class="stat-value">1.2M</div>
                            <div style="color: #8b5cf6; font-size: 12px;">48 qualified leads</div>
                        </div>
                    </div>
                </div>

                <!-- Lead Funnel -->
                <div class="table-container">
                    <h3 class="table-title">Lead Funnel</h3>
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 20px; margin-top: 20px;">
                        <div class="funnel-stage">
                            <div class="funnel-label">NEW</div>
                            <div class="funnel-value" style="color: #60a5fa;">87</div>
                            <div style="font-size: 12px; color: #64748b;">35.2%</div>
                        </div>
                        <div class="funnel-stage">
                            <div class="funnel-label">CONTACTED</div>
                            <div class="funnel-value" style="color: #a78bfa;">65</div>
                            <div style="font-size: 12px; color: #64748b;">26.3%</div>
                        </div>
                        <div class="funnel-stage">
                            <div class="funnel-label">QUALIFIED</div>
                            <div class="funnel-value" style="color: #f59e0b;">48</div>
                            <div style="font-size: 12px; color: #64748b;">19.4%</div>
                        </div>
                        <div class="funnel-stage">
                            <div class="funnel-label">NEGOTIATION</div>
                            <div class="funnel-value" style="color: #10b981;">31</div>
                            <div style="font-size: 12px; color: #64748b;">12.6%</div>
                        </div>
                        <div class="funnel-stage">
                            <div class="funnel-label">WON</div>
                            <div class="funnel-value" style="color: #34d399;">16</div>
                            <div style="font-size: 12px; color: #64748b;">6.5%</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Grid -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px; margin-top: 24px;">
                    <!-- Lead Source Chart -->
                    <div class="chart-container">
                        <h3 class="chart-title">Lead Sources</h3>
                        <div style="position: relative; height: 250px;">
                            <canvas id="leadSourceChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Conversion Trend -->
                    <div class="chart-container">
                        <h3 class="chart-title">Weekly Conversion Trend</h3>
                        <div style="position: relative; height: 250px;">
                            <canvas id="conversionTrendChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities -->
                <div class="table-container" style="margin-top: 24px;">
                    <h3 class="table-title">Recent WhatsApp Activities</h3>
                    <div id="recent-activities-crm">
                        <div class="conversation-item">
                            <div class="conversation-avatar">HS</div>
                            <div class="conversation-details">
                                <div class="conversation-name">Haji Slamet</div>
                                <div class="conversation-preview">Assalamualaikum, saya mau tanya paket umroh...</div>
                            </div>
                            <div>
                                <div class="conversation-time">2 menit lalu</div>
                                <span class="badge badge-success" style="font-size: 11px;">Bot Handled</span>
                            </div>
                        </div>
                        <div class="conversation-item">
                            <div class="conversation-avatar">NA</div>
                            <div class="conversation-details">
                                <div class="conversation-name">Nur Aini</div>
                                <div class="conversation-preview">Apakah ada jadwal bulan Ramadhan?</div>
                            </div>
                            <div>
                                <div class="conversation-time">15 menit lalu</div>
                                <span class="badge badge-info" style="font-size: 11px;">Human</span>
                            </div>
                        </div>
                        <div class="conversation-item">
                            <div class="conversation-avatar">AS</div>
                            <div class="conversation-details">
                                <div class="conversation-name">Ahmad Subandi</div>
                                <div class="conversation-preview">Terima kasih infonya, saya akan diskusi dengan keluarga</div>
                            </div>
                            <div>
                                <div class="conversation-time">1 jam lalu</div>
                                <span class="badge badge-warning" style="font-size: 11px;">Follow-up</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Leads Page -->
            <div class="page" id="leads-page">
                <div class="table-header">
                    <h3 class="table-title">Lead Management</h3>
                    <div class="table-actions">
                        <input type="text" placeholder="Search leads..." style="padding: 8px 16px; border-radius: 8px; border: 1px solid rgba(71, 85, 105, 0.4); background: rgba(15, 23, 42, 0.5); color: #e2e8f0;">
                        <select style="padding: 8px 16px; border-radius: 8px; border: 1px solid rgba(71, 85, 105, 0.4); background: rgba(15, 23, 42, 0.5); color: #e2e8f0;">
                            <option>All Status</option>
                            <option>New</option>
                            <option>Contacted</option>
                            <option>Qualified</option>
                            <option>Negotiation</option>
                            <option>Won</option>
                            <option>Lost</option>
                        </select>
                    </div>
                </div>

                <div id="leads-list">
                    <!-- Lead Card Example -->
                    <div class="lead-card">
                        <div class="lead-header">
                            <div>
                                <h4 style="font-size: 16px; margin-bottom: 5px;">Ibu Fatimah Zahra</h4>
                                <div style="color: #94a3b8; font-size: 13px;">
                                    <span class="material-icons" style="font-size: 14px; vertical-align: middle;">phone</span>
                                    +62 812-3456-7890 ‚Ä¢ Jakarta Selatan
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div class="badge badge-warning">Qualified</div>
                                <div style="font-size: 12px; color: #64748b; margin-top: 5px;">2 days ago</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 15px 0;">
                            <div>
                                <div style="color: #94a3b8; font-size: 12px;">Interest</div>
                                <div style="font-weight: 600;">Paket Reguler 12 Hari</div>
                            </div>
                            <div>
                                <div style="color: #94a3b8; font-size: 12px;">Budget</div>
                                <div style="font-weight: 600;">20-30 Juta</div>
                            </div>
                            <div>
                                <div style="color: #94a3b8; font-size: 12px;">Departure</div>
                                <div style="font-weight: 600;">April 2025</div>
                            </div>
                        </div>
                        <div class="lead-tags">
                            <span class="lead-tag hot-lead">Hot Lead</span>
                            <span class="lead-tag" style="background: rgba(139, 92, 246, 0.2); color: #a78bfa; border: 1px solid rgba(139, 92, 246, 0.3);">Family Package</span>
                            <span class="lead-tag" style="background: rgba(59, 130, 246, 0.2); color: #60a5fa; border: 1px solid rgba(59, 130, 246, 0.3);">WhatsApp</span>
                        </div>
                        <div style="margin-top: 15px; display: flex; gap: 10px;">
                            <button class="btn btn-primary" style="font-size: 13px; padding: 6px 16px;">
                                <span class="material-icons" style="font-size: 16px;">chat</span> WhatsApp
                            </button>
                            <button class="btn btn-secondary" style="font-size: 13px; padding: 6px 16px;">
                                <span class="material-icons" style="font-size: 16px;">edit</span> Edit
                            </button>
                            <button class="btn btn-secondary" style="font-size: 13px; padding: 6px 16px;">
                                <span class="material-icons" style="font-size: 16px;">history</span> Activity
                            </button>
                        </div>
                    </div>

                    <!-- More lead cards... -->
                </div>
            </div>

            <!-- WhatsApp Conversations Page -->
            <div class="page" id="conversations-page">
                <!-- WAHA Control Panel -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 24px;">
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-icon">üì±</span>
                            <span class="stat-title">WhatsApp Status</span>
                        </div>
                        <div class="stat-value" id="wa-status" style="font-size: 18px;">Checking...</div>
                        <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn btn-secondary" onclick="checkWAHAStatus()" style="padding: 8px 16px; font-size: 13px;">
                                <span class="material-icons" style="font-size: 16px; margin-right: 5px;">refresh</span> Refresh
                            </button>
                            <button class="btn btn-primary" onclick="showQRModal()" style="padding: 8px 16px; font-size: 13px;">
                                <span class="material-icons" style="font-size: 16px; margin-right: 5px;">qr_code_scanner</span> Scan QR
                            </button>
                            <button class="btn btn-secondary" onclick="disconnectWA()" style="padding: 8px 16px; font-size: 13px;">
                                <span class="material-icons" style="font-size: 16px; margin-right: 5px;">link_off</span> Disconnect
                            </button>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-icon">ü§ñ</span>
                            <span class="stat-title">Bot Configuration</span>
                        </div>
                        <div style="margin-top: 10px;">
                            <label style="display: flex; align-items: center; margin-bottom: 10px;">
                                <input type="checkbox" id="bot-enabled" onchange="toggleBot()" style="margin-right: 10px;">
                                <span>Enable Auto-Reply Bot</span>
                            </label>
                            <select id="llm-provider" onchange="updateBotConfig()" style="width: 100%; padding: 8px; background: rgba(71, 85, 105, 0.3); border: 1px solid rgba(71, 85, 105, 0.5); border-radius: 8px; color: #e2e8f0;">
                                <option value="ollama">Ollama (Local)</option>
                                <option value="openai">OpenAI</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-header">
                            <span class="stat-icon">üìä</span>
                            <span class="stat-title">Today's Activity</span>
                        </div>
                        <div style="margin-top: 10px;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Messages Received:</span>
                                <span id="msg-received">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Bot Responses:</span>
                                <span id="bot-responses">0</span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Active Chats:</span>
                                <span id="active-chats">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="display: grid; grid-template-columns: 400px 1fr; gap: 24px; height: calc(100vh - 350px);">
                    <!-- Conversations List -->
                    <div class="table-container" style="height: 100%; overflow-y: auto;">
                        <h3 class="table-title">Active Conversations</h3>
                        <div id="conversation-list">
                            <div class="conversation-item" onclick="selectConversation('1')" style="cursor: pointer;">
                                <div class="conversation-avatar">HS</div>
                                <div class="conversation-details">
                                    <div class="conversation-name">Haji Slamet</div>
                                    <div class="conversation-preview">Assalamualaikum, saya mau tanya...</div>
                                </div>
                                <div>
                                    <div class="conversation-time">2m</div>
                                    <span class="badge badge-success" style="font-size: 10px;">Bot</span>
                                </div>
                            </div>
                            <!-- More conversations... -->
                        </div>
                    </div>

                    <!-- Chat View -->
                    <div class="chat-container">
                        <div class="chat-header">
                            <div class="conversation-avatar">HS</div>
                            <div>
                                <div class="conversation-name">Haji Slamet</div>
                                <div style="font-size: 12px; color: #94a3b8;">+62 812-3456-7890 ‚Ä¢ Lead #LEAD-20250727-0001</div>
                            </div>
                            <div style="margin-left: auto; display: flex; gap: 10px;">
                                <button class="btn btn-secondary" style="padding: 8px;">
                                    <span class="material-icons">person</span>
                                </button>
                                <button class="btn btn-secondary" style="padding: 8px;">
                                    <span class="material-icons">more_vert</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="chat-messages" id="chat-messages">
                            <div class="message inbound">
                                <div>Assalamualaikum, saya mau tanya paket umroh dong</div>
                                <div class="message-time">14:23</div>
                            </div>
                            <div class="message outbound bot">
                                <div>Waalaikumsalam! Terima kasih telah menghubungi Vauza Tamma Travel. Kami memiliki beberapa paket umroh yang bisa dipilih:
‚úàÔ∏è Paket Reguler 12 Hari - Mulai 25 Juta
‚úàÔ∏è Paket Plus Turki 15 Hari - Mulai 35 Juta
‚úàÔ∏è Paket VIP 9 Hari - Mulai 45 Juta

Untuk info detail, silakan ketik nama paket yang Anda minati.</div>
                                <div class="message-time">14:23 ‚Ä¢ Bot (confidence: 0.92)</div>
                            </div>
                            <div class="message inbound">
                                <div>Yang reguler 12 hari fasilitasnya apa aja ya?</div>
                                <div class="message-time">14:25</div>
                            </div>
                            <!-- More messages... -->
                        </div>
                        
                        <div class="chat-input">
                            <input type="text" placeholder="Type a message..." id="chat-input">
                            <button class="btn btn-primary">
                                <span class="material-icons">send</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Bot Configuration Page -->
            <div class="page" id="bot-config-page">
                <h1 class="page-title">AI Bot Configuration</h1>
                
                <div class="table-container">
                    <div class="config-section">
                        <h3 class="config-title">Bot Settings</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>Response Delay (ms)</label>
                                <input type="number" value="2000" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Confidence Threshold</label>
                                <input type="number" value="0.7" step="0.1" min="0" max="1" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Office Hours</label>
                                <input type="text" value="08:00-17:00" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Max Bot Attempts</label>
                                <input type="number" value="3" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h3 class="config-title">LLM Configuration</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div class="form-group">
                                <label>OpenAI API Key</label>
                                <input type="password" placeholder="sk-..." class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Model</label>
                                <select class="form-control">
                                    <option>gpt-3.5-turbo</option>
                                    <option>gpt-4</option>
                                    <option>gpt-4-turbo</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Temperature</label>
                                <input type="number" value="0.7" step="0.1" min="0" max="2" class="form-control">
                            </div>
                            <div class="form-group">
                                <label>Max Tokens</label>
                                <input type="number" value="150" class="form-control">
                            </div>
                        </div>
                    </div>
                    
                    <div class="config-section">
                        <h3 class="config-title">Response Templates</h3>
                        <button class="btn btn-primary" style="margin-bottom: 15px;">
                            <span class="material-icons">add</span> Add Template
                        </button>
                        
                        <div class="template-item">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="margin: 0;">Greeting Template</h4>
                                <div>
                                    <span class="badge badge-info" style="font-size: 11px;">Used 1,234 times</span>
                                    <button class="btn-icon"><span class="material-icons">edit</span></button>
                                    <button class="btn-icon"><span class="material-icons">delete</span></button>
                                </div>
                            </div>
                            <p style="margin: 10px 0; color: #cbd5e1; font-size: 14px;">Waalaikumsalam {greeting}! Terima kasih telah menghubungi Vauza Tamma Travel...</p>
                            <div class="template-keywords">
                                <span class="keyword-chip">assalamualaikum</span>
                                <span class="keyword-chip">halo</span>
                                <span class="keyword-chip">hai</span>
                                <span class="keyword-chip">pagi</span>
                                <span class="keyword-chip">siang</span>
                            </div>
                        </div>
                        
                        <div class="template-item">
                            <div style="display: flex; justify-content: space-between; align-items: center;">
                                <h4 style="margin: 0;">Package Info Template</h4>
                                <div>
                                    <span class="badge badge-info" style="font-size: 11px;">Used 892 times</span>
                                    <button class="btn-icon"><span class="material-icons">edit</span></button>
                                    <button class="btn-icon"><span class="material-icons">delete</span></button>
                                </div>
                            </div>
                            <p style="margin: 10px 0; color: #cbd5e1; font-size: 14px;">Kami memiliki beberapa paket umroh yang bisa dipilih...</p>
                            <div class="template-keywords">
                                <span class="keyword-chip">paket</span>
                                <span class="keyword-chip">harga</span>
                                <span class="keyword-chip">biaya</span>
                                <span class="keyword-chip">program</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <button class="btn btn-primary">
                            <span class="material-icons">save</span> Save Configuration
                        </button>
                        <button class="btn btn-secondary">
                            <span class="material-icons">refresh</span> Test Bot
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Initialize Charts
        function initializeCRMCharts() {
            // Set default chart options
            Chart.defaults.responsive = true;
            Chart.defaults.maintainAspectRatio = false;
            
            // Lead Source Chart
            const sourceCtx = document.getElementById('leadSourceChart');
            new Chart(sourceCtx, {
                type: 'doughnut',
                data: {
                    labels: ['WhatsApp', 'Website', 'Instagram', 'Referral', 'Others'],
                    datasets: [{
                        data: [125, 48, 35, 28, 11],
                        backgroundColor: [
                            'rgba(16, 185, 129, 0.8)',
                            'rgba(59, 130, 246, 0.8)',
                            'rgba(139, 92, 246, 0.8)',
                            'rgba(251, 146, 60, 0.8)',
                            'rgba(107, 114, 128, 0.8)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { color: '#e2e8f0' }
                        }
                    }
                }
            });

            // Conversion Trend Chart
            const trendCtx = document.getElementById('conversionTrendChart');
            new Chart(trendCtx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
                    datasets: [{
                        label: 'Conversion Rate',
                        data: [8.5, 10.2, 11.8, 12.4],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { callback: (value) => value + '%', color: '#94a3b8' },
                            grid: { color: 'rgba(71, 85, 105, 0.3)' }
                        },
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: 'rgba(71, 85, 105, 0.3)' }
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        // Page switching
        function switchCRMPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            document.getElementById(`${page}-page`).classList.add('active');
            event.currentTarget.classList.add('active');
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            initializeCRMCharts();
        });

        // Chat functions
        function selectConversation(id) {
            // Load conversation messages
            console.log('Loading conversation:', id);
            
            // Set current phone for sending messages
            // In real app, get this from conversation data
            currentPhone = '6281234567890'; // Example phone number
            
            // Update UI to show selected conversation
            document.querySelectorAll('.conversation-item').forEach(item => {
                item.style.background = '';
            });
            event.currentTarget.style.background = 'rgba(59, 130, 246, 0.2)';
        }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (message) {
                // Send via WAHA
                sendWAMessage(message);
            }
        }

        // WAHA Integration Functions
        const WAHA_URL = 'http://localhost:3001';
        const WAHA_API_KEY = 'your-secret-api-key';
        let currentPhone = null;
        let waStatus = 'unknown';

        async function checkWAHAStatus() {
            const statusDiv = document.getElementById('wa-status');
            try {
                const response = await fetch(`${WAHA_URL}/api/sessions/default`, {
                    headers: { 'X-Api-Key': WAHA_API_KEY }
                });
                const data = await response.json();
                
                waStatus = data.status;
                
                if (data.status === 'WORKING') {
                    statusDiv.innerHTML = `<span style="color: #10b981;">‚úÖ Connected - ${data.me?.pushName || 'Unknown'}</span>`;
                } else if (data.status === 'SCAN_QR_CODE') {
                    statusDiv.innerHTML = `<span style="color: #f59e0b;">üì∑ Need to scan QR Code</span>`;
                } else if (data.status === 'STOPPED') {
                    statusDiv.innerHTML = `<span style="color: #ef4444;">‚èπÔ∏è Stopped - <a href="#" onclick="startWASession(); return false;" style="color: #60a5fa;">Click to start</a></span>`;
                } else {
                    statusDiv.innerHTML = `<span style="color: #94a3b8;">Status: ${data.status}</span>`;
                }
                
                // Update stats
                updateWAStats();
            } catch (error) {
                statusDiv.innerHTML = `<span style="color: #ef4444;">‚ùå Error: ${error.message}</span>`;
                waStatus = 'error';
            }
        }

        function showQRModal() {
            const modal = document.getElementById('qr-modal');
            if (!modal) {
                createQRModal();
            }
            document.getElementById('qr-modal').style.display = 'flex';
            loadQRCode();
        }

        function closeQRModal() {
            document.getElementById('qr-modal').style.display = 'none';
        }

        function createQRModal() {
            const modal = document.createElement('div');
            modal.id = 'qr-modal';
            modal.className = 'modal';
            modal.style.cssText = 'display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; align-items: center; justify-content: center;';
            
            modal.innerHTML = `
                <div class="modal-content" style="background: #1e293b; border-radius: 16px; padding: 24px; max-width: 500px; width: 90%; position: relative;">
                    <button onclick="closeQRModal()" style="position: absolute; top: 10px; right: 10px; background: none; border: none; color: #94a3b8; font-size: 24px; cursor: pointer;">√ó</button>
                    <h2 style="color: #60a5fa; margin-bottom: 20px; text-align: center;">Scan WhatsApp QR Code</h2>
                    <div id="qr-status" style="text-align: center; margin-bottom: 20px;">Loading QR Code...</div>
                    <div id="qr-container" style="background: white; padding: 20px; display: inline-block; border-radius: 10px; width: 100%; text-align: center;">
                        <img id="qr-image" style="max-width: 300px; height: auto;" alt="QR Code">
                    </div>
                    <div style="margin-top: 20px; color: #94a3b8; font-size: 14px;">
                        <ol style="text-align: left;">
                            <li>Open WhatsApp on your phone</li>
                            <li>Tap Menu or Settings and select Linked Devices</li>
                            <li>Tap on Link a Device</li>
                            <li>Point your phone at this screen to scan the code</li>
                        </ol>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        async function loadQRCode() {
            const statusDiv = document.getElementById('qr-status');
            const qrImage = document.getElementById('qr-image');
            
            try {
                // Get QR via screenshot endpoint
                const timestamp = new Date().getTime();
                const qrUrl = `${WAHA_URL}/api/screenshot?session=default&t=${timestamp}`;
                
                const response = await fetch(qrUrl, {
                    headers: {
                        'X-Api-Key': WAHA_API_KEY,
                        'Accept': 'image/png'
                    }
                });
                
                if (response.ok) {
                    const blob = await response.blob();
                    const objectUrl = URL.createObjectURL(blob);
                    qrImage.src = objectUrl;
                    statusDiv.textContent = 'Please scan the QR code with WhatsApp';
                    
                    // Auto refresh every 20 seconds
                    setTimeout(() => {
                        if (document.getElementById('qr-modal').style.display !== 'none') {
                            loadQRCode();
                        }
                    }, 20000);
                } else {
                    statusDiv.innerHTML = '<span style="color: #ef4444;">Failed to load QR code. Please check WAHA status.</span>';
                }
            } catch (error) {
                statusDiv.innerHTML = `<span style="color: #ef4444;">Error: ${error.message}</span>`;
            }
        }

        async function startWASession() {
            try {
                const response = await fetch(`${WAHA_URL}/api/sessions/default/start`, {
                    method: 'POST',
                    headers: { 'X-Api-Key': WAHA_API_KEY }
                });
                
                if (response.ok) {
                    alert('WhatsApp session started! Please scan QR code.');
                    checkWAHAStatus();
                    setTimeout(() => {
                        if (waStatus === 'SCAN_QR_CODE') {
                            showQRModal();
                        }
                    }, 2000);
                } else {
                    alert('Failed to start WhatsApp session');
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        async function disconnectWA() {
            if (confirm('Are you sure you want to disconnect WhatsApp?')) {
                try {
                    const response = await fetch(`${WAHA_URL}/api/sessions/default/stop`, {
                        method: 'POST',
                        headers: { 'X-Api-Key': WAHA_API_KEY }
                    });
                    
                    if (response.ok) {
                        alert('WhatsApp disconnected successfully');
                        checkWAHAStatus();
                    } else {
                        alert('Failed to disconnect WhatsApp');
                    }
                } catch (error) {
                    alert('Error: ' + error.message);
                }
            }
        }

        async function toggleBot() {
            const enabled = document.getElementById('bot-enabled').checked;
            // Save bot status to backend
            console.log('Bot enabled:', enabled);
            alert(`Bot ${enabled ? 'enabled' : 'disabled'}`);
        }

        async function updateBotConfig() {
            const provider = document.getElementById('llm-provider').value;
            // Save provider to backend
            console.log('LLM provider:', provider);
            alert(`Switched to ${provider}`);
        }

        async function sendWAMessage(message) {
            if (!currentPhone) {
                alert('Please select a conversation first');
                return;
            }
            
            try {
                const response = await fetch(`${WAHA_URL}/api/sendText`, {
                    method: 'POST',
                    headers: {
                        'X-Api-Key': WAHA_API_KEY,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        session: 'default',
                        chatId: currentPhone.includes('@') ? currentPhone : `${currentPhone}@c.us`,
                        text: message
                    })
                });
                
                if (response.ok) {
                    // Add message to chat UI
                    const messagesDiv = document.getElementById('chat-messages');
                    const messageEl = document.createElement('div');
                    messageEl.className = 'message outbound';
                    messageEl.innerHTML = `
                        <div>${message}</div>
                        <div class="message-time">${new Date().toLocaleTimeString('id-ID', { hour: '2-digit', minute: '2-digit' })}</div>
                    `;
                    messagesDiv.appendChild(messageEl);
                    
                    // Clear input
                    document.getElementById('chat-input').value = '';
                    
                    // Scroll to bottom
                    messagesDiv.scrollTop = messagesDiv.scrollHeight;
                } else {
                    alert('Failed to send message');
                }
            } catch (error) {
                alert('Error sending message: ' + error.message);
            }
        }

        function updateWAStats() {
            // Update statistics (in real app, fetch from backend)
            document.getElementById('msg-received').textContent = '15';
            document.getElementById('bot-responses').textContent = '12';
            document.getElementById('active-chats').textContent = '3';
        }

        // Initialize WhatsApp status on page load
        if (document.getElementById('wa-status')) {
            checkWAHAStatus();
            // Auto-refresh every 30 seconds
            setInterval(checkWAHAStatus, 30000);
        }
    </script>
</body>
</html>