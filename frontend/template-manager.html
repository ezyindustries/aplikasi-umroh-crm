<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Manager - WhatsApp CRM</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 50%, #475569 75%, #64748b 100%);
            color: #e2e8f0;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        /* Background overlay effects */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(16, 185, 129, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 1;
        }
        
        /* Floating particles effect */
        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 1;
        }
        
        .particle {
            position: absolute;
            display: block;
            pointer-events: none;
            opacity: 0.5;
        }
        
        /* Main container */
        .container {
            position: relative;
            z-index: 2;
            max-width: 1400px;
            margin: 0 auto;
            padding: 24px;
        }
        
        /* Header */
        .header {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.85), rgba(15, 23, 42, 0.75));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 20px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            box-shadow: 
                inset 0 1px 0 rgba(71, 85, 105, 0.4),
                0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 20px;
            font-weight: 600;
            background: linear-gradient(135deg, #3b82f6, #10b981, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .logo .material-icons {
            font-size: 28px;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .notification-btn {
            position: relative;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(145deg, rgba(51, 65, 85, 0.6), rgba(30, 41, 59, 0.4));
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .notification-btn:hover {
            background: linear-gradient(145deg, rgba(71, 85, 105, 0.6), rgba(51, 65, 85, 0.4));
            transform: translateY(-2px);
        }
        
        .notification-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            font-size: 10px;
            font-weight: 600;
            min-width: 18px;
            height: 18px;
            border-radius: 9px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0 4px;
            border: 2px solid #1e293b;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px 8px 8px;
            background: linear-gradient(145deg, rgba(51, 65, 85, 0.6), rgba(30, 41, 59, 0.4));
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 14px;
        }
        
        .user-name {
            font-weight: 500;
            font-size: 14px;
            color: #e2e8f0;
        }
        
        .user-role {
            font-size: 12px;
            color: #94a3b8;
        }
        
        /* Page Title */
        .page-title {
            margin-bottom: 32px;
        }
        
        .page-title h1 {
            font-size: 32px;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #10b981, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        
        .page-title p {
            color: #94a3b8;
            font-size: 16px;
        }
        
        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 32px;
        }
        
        .stat-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.85), rgba(15, 23, 42, 0.75));
            backdrop-filter: blur(20px);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            box-shadow: 
                inset 0 1px 0 rgba(71, 85, 105, 0.4),
                0 10px 20px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 
                inset 0 1px 0 rgba(71, 85, 105, 0.4),
                0 15px 30px rgba(0, 0, 0, 0.3);
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 12px;
        }
        
        .stat-icon.blue {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(37, 99, 235, 0.2));
            color: #3b82f6;
        }
        
        .stat-icon.green {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(5, 150, 105, 0.2));
            color: #10b981;
        }
        
        .stat-icon.purple {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.2), rgba(124, 58, 237, 0.2));
            color: #8b5cf6;
        }
        
        .stat-icon.orange {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2));
            color: #f59e0b;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #94a3b8;
        }
        
        /* Main Content Grid */
        .content-grid {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 24px;
        }
        
        /* Category Sidebar */
        .category-sidebar {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.85), rgba(15, 23, 42, 0.75));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 24px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            box-shadow: 
                inset 0 1px 0 rgba(71, 85, 105, 0.4),
                0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .category-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            color: #3b82f6;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-icon:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }
        
        .category-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .category-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            background: linear-gradient(145deg, rgba(51, 65, 85, 0.6), rgba(30, 41, 59, 0.4));
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-item:hover {
            background: linear-gradient(145deg, rgba(71, 85, 105, 0.6), rgba(51, 65, 85, 0.4));
            transform: translateX(4px);
        }
        
        .category-item.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(16, 185, 129, 0.1));
            border-color: rgba(59, 130, 246, 0.5);
        }
        
        .category-icon {
            font-size: 20px;
            color: #3b82f6;
        }
        
        .category-name {
            flex: 1;
            font-weight: 500;
        }
        
        .category-count {
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        /* Templates Content */
        .templates-content {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.85), rgba(15, 23, 42, 0.75));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 32px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            box-shadow: 
                inset 0 1px 0 rgba(71, 85, 105, 0.4),
                0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .content-title {
            font-size: 24px;
            font-weight: 600;
        }
        
        .header-actions-group {
            display: flex;
            gap: 12px;
        }
        
        .btn {
            padding: 10px 20px;
            border-radius: 12px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            color: white;
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 4px 12px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 
                inset 0 1px 0 rgba(255, 255, 255, 0.2),
                0 8px 16px rgba(59, 130, 246, 0.4);
        }
        
        .btn-secondary {
            background: rgba(71, 85, 105, 0.3);
            color: #e2e8f0;
            border: 1px solid rgba(71, 85, 105, 0.5);
        }
        
        .btn-secondary:hover {
            background: rgba(71, 85, 105, 0.5);
            transform: translateY(-2px);
        }
        
        /* Search Bar */
        .search-bar {
            position: relative;
            margin-bottom: 24px;
        }
        
        .search-input {
            width: 100%;
            padding: 12px 16px 12px 48px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 12px;
            color: #e2e8f0;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .search-input:focus {
            outline: none;
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #64748b;
            font-size: 20px;
        }
        
        /* Template Cards */
        .templates-grid {
            display: grid;
            gap: 16px;
        }
        
        .template-card {
            background: linear-gradient(145deg, rgba(51, 65, 85, 0.6), rgba(30, 41, 59, 0.4));
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        
        .template-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        }
        
        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 16px;
        }
        
        .template-info {
            flex: 1;
        }
        
        .template-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .template-category {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 4px 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 8px;
            font-size: 12px;
            color: #3b82f6;
        }
        
        .template-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid rgba(71, 85, 105, 0.5);
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 18px;
        }
        
        .action-btn:hover {
            background: rgba(71, 85, 105, 0.5);
            color: #e2e8f0;
            transform: translateY(-2px);
        }
        
        .action-btn.edit {
            color: #3b82f6;
        }
        
        .action-btn.delete {
            color: #ef4444;
        }
        
        .template-content {
            background: rgba(15, 23, 42, 0.4);
            border: 1px solid rgba(71, 85, 105, 0.2);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            font-size: 14px;
            line-height: 1.6;
            color: #cbd5e1;
            max-height: 100px;
            overflow-y: auto;
        }
        
        .template-variables {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .variable-tag {
            padding: 4px 10px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 6px;
            font-size: 12px;
            color: #8b5cf6;
            font-family: 'Monaco', 'Menlo', monospace;
        }
        
        .template-stats {
            display: flex;
            gap: 16px;
            padding-top: 16px;
            border-top: 1px solid rgba(71, 85, 105, 0.2);
        }
        
        .stat-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: #94a3b8;
        }
        
        .stat-item .material-icons {
            font-size: 16px;
        }
        
        .stat-value {
            font-weight: 600;
            color: #e2e8f0;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
        }
        
        .empty-icon {
            font-size: 72px;
            color: #475569;
            margin-bottom: 16px;
        }
        
        .empty-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 8px;
        }
        
        .empty-text {
            color: #94a3b8;
            margin-bottom: 24px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.85));
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid rgba(71, 85, 105, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 24px 24px 20px;
            border-bottom: 1px solid rgba(71, 85, 105, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }
        
        .modal-close {
            width: 36px;
            height: 36px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid rgba(71, 85, 105, 0.5);
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(71, 85, 105, 0.5);
            color: #e2e8f0;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 8px;
            color: #cbd5e1;
        }
        
        .form-control {
            width: 100%;
            padding: 10px 16px;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 10px;
            color: #e2e8f0;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            outline: none;
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        textarea.form-control {
            resize: vertical;
            min-height: 120px;
            font-family: inherit;
        }
        
        select.form-control {
            cursor: pointer;
        }
        
        .form-hint {
            font-size: 12px;
            color: #94a3b8;
            margin-top: 4px;
        }
        
        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid rgba(71, 85, 105, 0.2);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }
        
        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(59, 130, 246, 0.2);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .category-sidebar {
                display: none;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .header {
                padding: 16px 20px;
            }
            
            .templates-content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- Floating particles -->
    <div class="particles" id="particles"></div>
    
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="material-icons">hub</span>
                Vauza Tamma Management System
            </div>
            <div class="header-actions">
                <div class="notification-btn">
                    <span class="material-icons">notifications</span>
                    <span class="notification-badge">3</span>
                </div>
                <div class="user-profile">
                    <div class="user-avatar">
                        <span class="avatar-initials">A</span>
                    </div>
                    <div>
                        <div class="user-name">Admin</div>
                        <div class="user-role">Administrator</div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Page Title -->
        <div class="page-title">
            <h1>Template Manager</h1>
            <p>Kelola template respons otomatis untuk percakapan WhatsApp</p>
        </div>
        
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon blue">
                    <span class="material-icons">description</span>
                </div>
                <div class="stat-value" id="totalTemplates">0</div>
                <div class="stat-label">Total Template</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon green">
                    <span class="material-icons">check_circle</span>
                </div>
                <div class="stat-value" id="activeTemplates">0</div>
                <div class="stat-label">Template Aktif</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon purple">
                    <span class="material-icons">trending_up</span>
                </div>
                <div class="stat-value" id="totalUsage">0</div>
                <div class="stat-label">Total Penggunaan</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orange">
                    <span class="material-icons">analytics</span>
                </div>
                <div class="stat-value" id="avgSuccessRate">0%</div>
                <div class="stat-label">Tingkat Keberhasilan</div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="content-grid">
            <!-- Category Sidebar -->
            <aside class="category-sidebar">
                <div class="category-header">
                    <h3 class="category-title">Kategori</h3>
                    <button class="btn-icon" onclick="showImportModal()">
                        <span class="material-icons">upload_file</span>
                    </button>
                </div>
                <div class="category-list" id="categoryList">
                    <!-- Categories will be loaded here -->
                </div>
            </aside>
            
            <!-- Templates Content -->
            <main class="templates-content">
                <div class="content-header">
                    <h2 class="content-title" id="contentTitle">Semua Template</h2>
                    <div class="header-actions-group">
                        <button class="btn btn-secondary" onclick="testTemplates()">
                            <span class="material-icons">science</span>
                            Test Template
                        </button>
                        <button class="btn btn-primary" onclick="showCreateModal()">
                            <span class="material-icons">add</span>
                            Buat Template
                        </button>
                    </div>
                </div>
                
                <!-- Search Bar -->
                <div class="search-bar">
                    <span class="material-icons search-icon">search</span>
                    <input type="text" class="search-input" id="searchInput" placeholder="Cari template...">
                </div>
                
                <!-- Templates Grid -->
                <div class="templates-grid" id="templatesGrid">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <!-- Template Modal -->
    <div class="modal" id="templateModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle">Buat Template Baru</h3>
                <button class="modal-close" onclick="closeModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="templateForm">
                    <input type="hidden" id="templateId">
                    
                    <div class="form-group">
                        <label class="form-label">Nama Template</label>
                        <input type="text" class="form-control" id="templateName" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Kategori</label>
                        <select class="form-control" id="templateCategory" required>
                            <option value="">Pilih Kategori</option>
                            <option value="greeting">Greeting Messages</option>
                            <option value="package">Package Information</option>
                            <option value="faq">FAQ Responses</option>
                            <option value="followup">Follow Up Messages</option>
                            <option value="document">Document Templates</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Konten Template</label>
                        <textarea class="form-control" id="templateContent" required></textarea>
                        <div class="form-hint">Gunakan {{variabel}} untuk membuat template dinamis. Contoh: {{nama}}, {{tanggal}}, {{harga}}</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Keywords</label>
                        <input type="text" class="form-control" id="templateKeywords">
                        <div class="form-hint">Pisahkan dengan koma. Contoh: harga, biaya, paket umroh</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Priority</label>
                        <input type="number" class="form-control" id="templatePriority" value="0" min="0" max="100">
                        <div class="form-hint">Template dengan priority lebih tinggi akan diprioritaskan</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">AI Intent (Optional)</label>
                        <select class="form-control" id="templateIntent">
                            <option value="">-- No Intent --</option>
                            <option value="greeting">Greeting</option>
                            <option value="inquiry_package">Package Inquiry</option>
                            <option value="inquiry_price">Price Inquiry</option>
                            <option value="inquiry_schedule">Schedule Inquiry</option>
                            <option value="inquiry_document">Document Inquiry</option>
                            <option value="inquiry_payment">Payment Inquiry</option>
                            <option value="inquiry_facility">Facility Inquiry</option>
                            <option value="booking_intent">Booking Intent</option>
                            <option value="complaint">Complaint</option>
                            <option value="thanks">Thank You</option>
                        </select>
                        <div class="form-hint">Link template dengan AI intent detection untuk matching yang lebih akurat</div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Minimum Confidence</label>
                        <input type="number" class="form-control" id="templateMinConfidence" value="0.7" min="0" max="1" step="0.1">
                        <div class="form-hint">Confidence score minimum untuk intent matching (0.0 - 1.0)</div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">Batal</button>
                <button class="btn btn-primary" onclick="saveTemplate()">
                    <span class="material-icons">save</span>
                    Simpan
                </button>
            </div>
        </div>
    </div>
    
    <!-- Import Modal -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Import dari Chat History</h3>
                <button class="modal-close" onclick="closeImportModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Upload Chat File</label>
                    <input type="file" class="form-control" id="chatFile" accept=".txt,.json">
                    <div class="form-hint">Upload file chat WhatsApp dalam format .txt atau .json</div>
                </div>
                
                <div id="importResults" style="display: none;">
                    <h4 style="margin: 20px 0 12px;">Template yang Ditemukan:</h4>
                    <div id="extractedTemplates"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeImportModal()">Tutup</button>
                <button class="btn btn-primary" onclick="importFromChat()">
                    <span class="material-icons">upload</span>
                    Analyze & Import
                </button>
            </div>
        </div>
    </div>
    
    <!-- Test Modal -->
    <div class="modal" id="testModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Test Template</h3>
                <button class="modal-close" onclick="closeTestModal()">
                    <span class="material-icons">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Pesan dari Customer</label>
                    <textarea class="form-control" id="testMessage" placeholder="Ketik pesan customer untuk test matching..."></textarea>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Kategori (Opsional)</label>
                    <select class="form-control" id="testCategory">
                        <option value="">Semua Kategori</option>
                        <option value="greeting">Greeting Messages</option>
                        <option value="package">Package Information</option>
                        <option value="faq">FAQ Responses</option>
                        <option value="followup">Follow Up Messages</option>
                        <option value="document">Document Templates</option>
                    </select>
                </div>
                
                <div id="testResult" style="display: none;">
                    <h4 style="margin: 20px 0 12px;">Hasil Matching:</h4>
                    <div id="matchedTemplate"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeTestModal()">Tutup</button>
                <button class="btn btn-primary" onclick="runTemplateTest()">
                    <span class="material-icons">play_arrow</span>
                    Test Matching
                </button>
            </div>
        </div>
    </div>
    
    <!-- Test Template Modal -->
    <div id="testModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Test Template</h2>
                <span class="close" onclick="closeTestModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="test-section">
                    <h3>Test Message</h3>
                    <textarea id="testMessage" placeholder="Enter test message..." rows="3"></textarea>
                </div>
                
                <div class="test-actions">
                    <button class="btn btn-primary" onclick="runTemplateTest()">
                        <span class="material-icons">science</span>
                        Run Test
                    </button>
                </div>
                
                <div id="testResults" class="test-results"></div>
            </div>
        </div>
    </div>
    
    <style>
        /* Modal Styles */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            position: relative;
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.9));
            backdrop-filter: blur(20px);
            margin: 5% auto;
            padding: 0;
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 20px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid rgba(71, 85, 105, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .close {
            color: #94a3b8;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .close:hover {
            color: #e2e8f0;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .test-section {
            margin-bottom: 24px;
        }
        
        .test-section h3 {
            margin-bottom: 12px;
            color: #cbd5e1;
            font-size: 16px;
        }
        
        .test-section textarea {
            width: 100%;
            padding: 12px;
            background: rgba(15, 23, 42, 0.5);
            border: 1px solid rgba(71, 85, 105, 0.3);
            border-radius: 12px;
            color: #e2e8f0;
            font-size: 14px;
            resize: vertical;
        }
        
        .test-section textarea:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1);
        }
        
        .test-actions {
            margin: 24px 0;
        }
        
        .test-results {
            margin-top: 24px;
        }
        
        .result-card {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }
        
        .result-label {
            font-size: 12px;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }
        
        .result-value {
            color: #e2e8f0;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .intent-result {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            margin-bottom: 12px;
        }
        
        .confidence-bar {
            flex: 1;
            height: 8px;
            background: rgba(71, 85, 105, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            transition: width 0.5s ease;
        }
        
        .matched-template {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
        }
        
        .template-preview {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            margin-top: 12px;
            font-family: monospace;
            font-size: 13px;
            white-space: pre-wrap;
            color: #cbd5e1;
        }
    </style>
    
    <script>
        // API Configuration
        const API_URL = 'http://localhost:3003/api';
        
        // State
        let templates = [];
        let categories = [];
        let selectedCategory = null;
        let searchQuery = '';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            createParticles();
            loadCategories();
            loadTemplates();
            setupEventListeners();
        });
        
        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 10;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('span');
                particle.className = 'particle';
                
                // Random size
                const size = Math.random() * 4 + 2;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                
                // Random position
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                
                // Random color
                const colors = ['#3b82f6', '#10b981', '#8b5cf6', '#f59e0b', '#ec4899'];
                particle.style.background = colors[Math.floor(Math.random() * colors.length)];
                particle.style.borderRadius = '50%';
                
                // Random animation
                const duration = Math.random() * 20 + 20;
                const delay = Math.random() * 5;
                particle.style.animation = `float ${duration}s ${delay}s infinite ease-in-out`;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // Add float animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0%, 100% {
                    transform: translateY(0) translateX(0);
                    opacity: 0.5;
                }
                25% {
                    transform: translateY(-100px) translateX(50px);
                    opacity: 0.8;
                }
                50% {
                    transform: translateY(-50px) translateX(-30px);
                    opacity: 0.3;
                }
                75% {
                    transform: translateY(-80px) translateX(-50px);
                    opacity: 0.6;
                }
            }
        `;
        document.head.appendChild(style);
        
        // Setup event listeners
        function setupEventListeners() {
            document.getElementById('searchInput').addEventListener('input', (e) => {
                searchQuery = e.target.value;
                filterTemplates();
            });
        }
        
        // Load categories
        async function loadCategories() {
            try {
                const response = await fetch(`${API_URL}/templates/categories`);
                const result = await response.json();
                
                if (result.success) {
                    categories = result.data;
                    renderCategories();
                }
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }
        
        // Render categories
        function renderCategories() {
            const categoryList = document.getElementById('categoryList');
            
            // Add "All" category
            let html = `
                <div class="category-item ${!selectedCategory ? 'active' : ''}" onclick="selectCategory(null)">
                    <span class="material-icons category-icon">folder</span>
                    <span class="category-name">Semua Template</span>
                    <span class="category-count" id="allCount">0</span>
                </div>
            `;
            
            // Add other categories
            categories.forEach(cat => {
                html += `
                    <div class="category-item ${selectedCategory === cat.value ? 'active' : ''}" onclick="selectCategory('${cat.value}')">
                        <span class="material-icons category-icon">${cat.icon}</span>
                        <span class="category-name">${cat.label}</span>
                        <span class="category-count" id="${cat.value}Count">0</span>
                    </div>
                `;
            });
            
            categoryList.innerHTML = html;
        }
        
        // Select category
        function selectCategory(category) {
            selectedCategory = category;
            document.getElementById('contentTitle').textContent = category ? 
                categories.find(c => c.value === category)?.label || 'Templates' : 
                'Semua Template';
            renderCategories();
            filterTemplates();
        }
        
        // Load templates
        async function loadTemplates() {
            try {
                const response = await fetch(`${API_URL}/templates`);
                const result = await response.json();
                
                if (result.success) {
                    templates = result.data;
                    updateStats();
                    filterTemplates();
                }
            } catch (error) {
                console.error('Error loading templates:', error);
                showError('Gagal memuat template');
            }
        }
        
        // Update statistics
        function updateStats() {
            // Total templates
            document.getElementById('totalTemplates').textContent = templates.length;
            
            // Active templates
            const activeCount = templates.filter(t => t.isActive).length;
            document.getElementById('activeTemplates').textContent = activeCount;
            
            // Total usage
            const totalUsage = templates.reduce((sum, t) => sum + (t.usageCount || 0), 0);
            document.getElementById('totalUsage').textContent = totalUsage;
            
            // Average success rate
            const avgSuccess = templates.length > 0 ?
                Math.round(templates.reduce((sum, t) => sum + (t.successRate || 0), 0) / templates.length) : 0;
            document.getElementById('avgSuccessRate').textContent = `${avgSuccess}%`;
            
            // Update category counts
            const categoryCounts = {};
            templates.forEach(t => {
                categoryCounts[t.category] = (categoryCounts[t.category] || 0) + 1;
            });
            
            document.getElementById('allCount').textContent = templates.length;
            categories.forEach(cat => {
                const countEl = document.getElementById(`${cat.value}Count`);
                if (countEl) {
                    countEl.textContent = categoryCounts[cat.value] || 0;
                }
            });
        }
        
        // Filter templates
        function filterTemplates() {
            let filtered = templates;
            
            // Filter by category
            if (selectedCategory) {
                filtered = filtered.filter(t => t.category === selectedCategory);
            }
            
            // Filter by search
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filtered = filtered.filter(t => 
                    t.templateName.toLowerCase().includes(query) ||
                    t.templateContent.toLowerCase().includes(query) ||
                    (t.keywords && t.keywords.toLowerCase().includes(query))
                );
            }
            
            renderTemplates(filtered);
        }
        
        // Render templates
        function renderTemplates(templatesData) {
            const grid = document.getElementById('templatesGrid');
            
            if (templatesData.length === 0) {
                grid.innerHTML = `
                    <div class="empty-state">
                        <span class="material-icons empty-icon">inbox</span>
                        <h3 class="empty-title">Belum ada template</h3>
                        <p class="empty-text">Mulai dengan membuat template baru atau import dari chat history</p>
                        <button class="btn btn-primary" onclick="showCreateModal()">
                            <span class="material-icons">add</span>
                            Buat Template Pertama
                        </button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = templatesData.map(template => {
                // Extract variables from content
                const variables = [];
                const regex = /{{(\w+)}}/g;
                let match;
                while ((match = regex.exec(template.templateContent)) !== null) {
                    if (!variables.includes(match[1])) {
                        variables.push(match[1]);
                    }
                }
                
                const categoryInfo = categories.find(c => c.value === template.category);
                
                return `
                    <div class="template-card">
                        <div class="template-header">
                            <div class="template-info">
                                <h3 class="template-name">${template.templateName}</h3>
                                <span class="template-category">
                                    <span class="material-icons" style="font-size: 14px;">${categoryInfo?.icon || 'label'}</span>
                                    ${categoryInfo?.label || template.category}
                                </span>
                                ${template.intent ? `
                                    <span class="template-category" style="background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.3); color: #8b5cf6; margin-left: 8px;">
                                        <span class="material-icons" style="font-size: 14px;">psychology</span>
                                        AI: ${template.intent}
                                    </span>
                                ` : ''}
                            </div>
                            <div class="template-actions">
                                <button class="action-btn edit" onclick="editTemplate(${template.id})">
                                    <span class="material-icons">edit</span>
                                </button>
                                <button class="action-btn delete" onclick="deleteTemplate(${template.id})">
                                    <span class="material-icons">delete</span>
                                </button>
                            </div>
                        </div>
                        
                        <div class="template-content">${template.templateContent}</div>
                        
                        ${variables.length > 0 ? `
                            <div class="template-variables">
                                ${variables.map(v => `<span class="variable-tag">{{${v}}}</span>`).join('')}
                            </div>
                        ` : ''}
                        
                        <div class="template-stats">
                            <div class="stat-item">
                                <span class="material-icons">tag</span>
                                <span class="stat-value">${template.priority || 0}</span>
                                Priority
                            </div>
                            <div class="stat-item">
                                <span class="material-icons">send</span>
                                <span class="stat-value">${template.usageCount || 0}</span>
                                Digunakan
                            </div>
                            <div class="stat-item">
                                <span class="material-icons">check_circle</span>
                                <span class="stat-value">${template.successRate || 0}%</span>
                                Success
                            </div>
                            <div class="stat-item">
                                <span class="material-icons">${template.isActive ? 'toggle_on' : 'toggle_off'}</span>
                                <span class="stat-value">${template.isActive ? 'Aktif' : 'Nonaktif'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        // Show create modal
        function showCreateModal() {
            document.getElementById('modalTitle').textContent = 'Buat Template Baru';
            document.getElementById('templateForm').reset();
            document.getElementById('templateId').value = '';
            document.getElementById('templateModal').classList.add('active');
        }
        
        // Edit template
        async function editTemplate(id) {
            try {
                const response = await fetch(`${API_URL}/templates/${id}`);
                const result = await response.json();
                
                if (result.success) {
                    const template = result.data;
                    document.getElementById('modalTitle').textContent = 'Edit Template';
                    document.getElementById('templateId').value = template.id;
                    document.getElementById('templateName').value = template.templateName;
                    document.getElementById('templateCategory').value = template.category;
                    document.getElementById('templateContent').value = template.templateContent;
                    document.getElementById('templateKeywords').value = template.keywords || '';
                    document.getElementById('templatePriority').value = template.priority || 0;
                    document.getElementById('templateIntent').value = template.intent || '';
                    document.getElementById('templateMinConfidence').value = template.minConfidence || 0.7;
                    document.getElementById('templateModal').classList.add('active');
                }
            } catch (error) {
                console.error('Error loading template:', error);
                showError('Gagal memuat template');
            }
        }
        
        // Save template
        async function saveTemplate() {
            const id = document.getElementById('templateId').value;
            const data = {
                templateName: document.getElementById('templateName').value,
                category: document.getElementById('templateCategory').value,
                templateContent: document.getElementById('templateContent').value,
                keywords: document.getElementById('templateKeywords').value,
                priority: parseInt(document.getElementById('templatePriority').value) || 0,
                intent: document.getElementById('templateIntent').value || null,
                minConfidence: parseFloat(document.getElementById('templateMinConfidence').value) || 0.7
            };
            
            try {
                const url = id ? `${API_URL}/templates/${id}` : `${API_URL}/templates`;
                const method = id ? 'PUT' : 'POST';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess(id ? 'Template berhasil diupdate' : 'Template berhasil dibuat');
                    closeModal();
                    loadTemplates();
                } else {
                    showError(result.error || 'Gagal menyimpan template');
                }
            } catch (error) {
                console.error('Error saving template:', error);
                showError('Gagal menyimpan template');
            }
        }
        
        // Test template functionality
        let currentTestTemplateId = null;
        
        function testTemplate(id) {
            currentTestTemplateId = id;
            const template = templates.find(t => t.id === id);
            
            document.getElementById('testModal').style.display = 'block';
            document.getElementById('testMessage').value = '';
            document.getElementById('testResults').innerHTML = '';
            
            // Show current template info
            document.getElementById('testResults').innerHTML = `
                <div class="result-card">
                    <div class="result-label">Testing Template</div>
                    <div class="result-value">${template.name}</div>
                    <div style="margin-top: 8px; color: #64748b; font-size: 12px;">
                        Category: ${template.category} | Priority: ${template.priority}
                    </div>
                </div>
            `;
        }
        
        function closeTestModal() {
            document.getElementById('testModal').style.display = 'none';
            currentTestTemplateId = null;
        }
        
        async function runTemplateTest() {
            const message = document.getElementById('testMessage').value.trim();
            if (!message) {
                alert('Please enter a test message');
                return;
            }
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<div class="loading">Testing...</div>';
            
            try {
                // Test template matching
                const response = await fetch(`${API_URL}/templates/test`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: message,
                        templateId: currentTestTemplateId
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Show test results
                    resultsDiv.innerHTML = `
                        <!-- Intent Detection Result -->
                        <div class="result-card">
                            <div class="result-label">Intent Detection</div>
                            <div class="intent-result">
                                <div>
                                    <strong>${result.intent?.intent || 'other'}</strong>
                                    <span style="color: #64748b; font-size: 12px;">
                                        (${result.intent?.reason || 'No specific intent detected'})
                                    </span>
                                </div>
                                <div class="confidence-bar">
                                    <div class="confidence-fill" style="width: ${(result.intent?.confidence || 0) * 100}%"></div>
                                </div>
                                <span>${Math.round((result.intent?.confidence || 0) * 100)}%</span>
                            </div>
                        </div>
                        
                        <!-- Entity Extraction Result -->
                        ${result.entities && Object.keys(result.entities).length > 0 ? `
                            <div class="result-card">
                                <div class="result-label">Extracted Entities</div>
                                ${Object.entries(result.entities).map(([key, value]) => `
                                    <div style="margin: 8px 0;">
                                        <span style="color: #64748b;">${key}:</span>
                                        <span style="color: #3b82f6;">${value}</span>
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        
                        <!-- Template Match Result -->
                        <div class="result-card">
                            <div class="result-label">Template Matching</div>
                            ${result.matched ? `
                                <div class="matched-template">
                                    <div style="font-weight: 600; margin-bottom: 8px;">
                                        ✅ Matched: ${result.matchedTemplate.name}
                                    </div>
                                    <div style="color: #64748b; font-size: 12px; margin-bottom: 12px;">
                                        Match Type: ${result.matchType} | Score: ${result.matchScore || 'N/A'}
                                    </div>
                                    <div class="template-preview">${result.filledTemplate}</div>
                                </div>
                            ` : `
                                <div style="color: #ef4444;">
                                    ❌ No template match found
                                </div>
                            `}
                        </div>
                    `;
                } else {
                    resultsDiv.innerHTML = `
                        <div class="result-card" style="border-color: #ef4444;">
                            <div style="color: #ef4444;">Error: ${result.error}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Test error:', error);
                resultsDiv.innerHTML = `
                    <div class="result-card" style="border-color: #ef4444;">
                        <div style="color: #ef4444;">Error: ${error.message}</div>
                    </div>
                `;
            }
        }
        
        // Delete template
        async function deleteTemplate(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus template ini?')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/templates/${id}`, {
                    method: 'DELETE'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showSuccess('Template berhasil dihapus');
                    loadTemplates();
                } else {
                    showError(result.error || 'Gagal menghapus template');
                }
            } catch (error) {
                console.error('Error deleting template:', error);
                showError('Gagal menghapus template');
            }
        }
        
        // Close modal
        function closeModal() {
            document.getElementById('templateModal').classList.remove('active');
        }
        
        // Show import modal
        function showImportModal() {
            document.getElementById('importModal').classList.add('active');
            document.getElementById('importResults').style.display = 'none';
        }
        
        // Close import modal
        function closeImportModal() {
            document.getElementById('importModal').classList.remove('active');
            document.getElementById('chatFile').value = '';
            document.getElementById('importResults').style.display = 'none';
        }
        
        // Import from chat
        async function importFromChat() {
            const fileInput = document.getElementById('chatFile');
            const file = fileInput.files[0];
            
            if (!file) {
                showError('Pilih file chat terlebih dahulu');
                return;
            }
            
            try {
                const content = await file.text();
                
                const response = await fetch(`${API_URL}/templates/import`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ chatContent: content })
                });
                
                const result = await response.json();
                
                if (result.success && result.data.length > 0) {
                    displayExtractedTemplates(result.data);
                } else {
                    showError('Tidak ditemukan template yang bisa diextract');
                }
            } catch (error) {
                console.error('Error importing templates:', error);
                showError('Gagal mengimport template');
            }
        }
        
        // Display extracted templates
        function displayExtractedTemplates(extractedTemplates) {
            const container = document.getElementById('extractedTemplates');
            
            container.innerHTML = extractedTemplates.map((template, index) => `
                <div style="background: rgba(15, 23, 42, 0.4); border: 1px solid rgba(71, 85, 105, 0.3); border-radius: 8px; padding: 12px; margin-bottom: 12px;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 8px;">
                        <span style="color: #3b82f6; font-weight: 500;">Muncul ${template.count}x</span>
                        <span class="template-category">
                            <span class="material-icons" style="font-size: 14px;">label</span>
                            ${template.suggestedCategory}
                        </span>
                    </div>
                    <div style="font-size: 13px; color: #cbd5e1; line-height: 1.5;">${template.content}</div>
                    <button class="btn btn-primary" style="margin-top: 12px; padding: 6px 12px; font-size: 12px;" onclick="createFromExtracted(${index})">
                        <span class="material-icons" style="font-size: 16px;">add</span>
                        Buat Template
                    </button>
                </div>
            `).join('');
            
            document.getElementById('importResults').style.display = 'block';
            
            // Store extracted templates temporarily
            window.extractedTemplates = extractedTemplates;
        }
        
        // Create template from extracted
        function createFromExtracted(index) {
            const template = window.extractedTemplates[index];
            
            closeImportModal();
            showCreateModal();
            
            document.getElementById('templateCategory').value = template.suggestedCategory;
            document.getElementById('templateContent').value = template.content;
            
            // Try to extract keywords
            const keywords = [];
            if (template.content.toLowerCase().includes('harga')) keywords.push('harga');
            if (template.content.toLowerCase().includes('paket')) keywords.push('paket');
            if (template.content.toLowerCase().includes('syarat')) keywords.push('syarat');
            if (template.content.toLowerCase().includes('dokumen')) keywords.push('dokumen');
            
            document.getElementById('templateKeywords').value = keywords.join(', ');
        }
        
        // Show test modal
        function testTemplates() {
            document.getElementById('testModal').classList.add('active');
            document.getElementById('testResult').style.display = 'none';
        }
        
        // Close test modal
        function closeTestModal() {
            document.getElementById('testModal').classList.remove('active');
            document.getElementById('testMessage').value = '';
            document.getElementById('testCategory').value = '';
            document.getElementById('testResult').style.display = 'none';
        }
        
        // Run template test
        async function runTemplateTest() {
            const message = document.getElementById('testMessage').value;
            const category = document.getElementById('testCategory').value;
            
            if (!message) {
                showError('Masukkan pesan untuk test');
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/templates/match`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message, category })
                });
                
                const result = await response.json();
                
                if (result.success && result.data) {
                    displayMatchedTemplate(result.data);
                } else {
                    displayNoMatch();
                }
            } catch (error) {
                console.error('Error testing template:', error);
                showError('Gagal menjalankan test');
            }
        }
        
        // Display matched template
        function displayMatchedTemplate(template) {
            const container = document.getElementById('matchedTemplate');
            const categoryInfo = categories.find(c => c.value === template.category);
            
            container.innerHTML = `
                <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; padding: 16px;">
                    <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 12px;">
                        <span class="material-icons" style="color: #10b981;">check_circle</span>
                        <span style="color: #10b981; font-weight: 500;">Template Matched!</span>
                    </div>
                    <div style="margin-bottom: 8px;">
                        <strong>${template.templateName}</strong>
                        <span class="template-category" style="margin-left: 8px;">
                            <span class="material-icons" style="font-size: 14px;">${categoryInfo?.icon || 'label'}</span>
                            ${categoryInfo?.label || template.category}
                        </span>
                    </div>
                    <div style="background: rgba(15, 23, 42, 0.4); border-radius: 6px; padding: 12px; font-size: 14px; line-height: 1.6;">
                        ${template.templateContent}
                    </div>
                    ${template.keywords ? `
                        <div style="margin-top: 12px; font-size: 12px; color: #94a3b8;">
                            Keywords: ${template.keywords}
                        </div>
                    ` : ''}
                </div>
            `;
            
            document.getElementById('testResult').style.display = 'block';
        }
        
        // Display no match
        function displayNoMatch() {
            const container = document.getElementById('matchedTemplate');
            
            container.innerHTML = `
                <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 16px; text-align: center;">
                    <span class="material-icons" style="color: #ef4444; font-size: 48px;">search_off</span>
                    <div style="color: #ef4444; font-weight: 500; margin-top: 8px;">Tidak ada template yang cocok</div>
                    <div style="color: #94a3b8; font-size: 14px; margin-top: 4px;">Coba dengan kata kunci lain atau buat template baru</div>
                </div>
            `;
            
            document.getElementById('testResult').style.display = 'block';
        }
        
        // Show success message
        function showSuccess(message) {
            // Simple alert for now - you can implement a better notification system
            alert(message);
        }
        
        // Show error message
        function showError(message) {
            // Simple alert for now - you can implement a better notification system
            alert('Error: ' + message);
        }
    </script>
</body>
</html>