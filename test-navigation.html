<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Navigation - CRM Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
            padding: 20px;
        }
        
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .success {
            background: #2d5a2d;
            color: #90ee90;
        }
        
        .error {
            background: #5a2d2d;
            color: #ff6b6b;
        }
        
        .warning {
            background: #5a5a2d;
            color: #ffff90;
        }
        
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            background: #3b82f6;
            color: white;
            cursor: pointer;
        }
        
        button:hover {
            background: #2563eb;
        }
        
        pre {
            background: #1a1a1a;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>CRM Dashboard Navigation Test</h1>
        
        <div class="test-section">
            <h2>Test Results</h2>
            <div id="test-results"></div>
        </div>
        
        <div class="test-section">
            <h2>Actions</h2>
            <button onclick="testNavigation()">Test Navigation</button>
            <button onclick="testButtons()">Test Buttons</button>
            <button onclick="testEventHandlers()">Test Event Handlers</button>
            <button onclick="openCRM()">Open CRM Dashboard</button>
        </div>
        
        <div class="test-section">
            <h2>Console Output</h2>
            <pre id="console-output"></pre>
        </div>
    </div>
    
    <script>
        const results = document.getElementById('test-results');
        const consoleOutput = document.getElementById('console-output');
        let logs = [];
        
        // Override console.log to capture output
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logs.push(args.join(' '));
            consoleOutput.textContent = logs.join('\n');
        };
        
        function addResult(message, type = 'success') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.textContent = message;
            results.appendChild(div);
        }
        
        function clearResults() {
            results.innerHTML = '';
            logs = [];
            consoleOutput.textContent = '';
        }
        
        async function testNavigation() {
            clearResults();
            addResult('Starting navigation test...');
            
            // Test if CRM pages exist
            const pages = [
                '/frontend/crm-dashboard-pro.html',
                '/frontend/crm-simple.html',
                '/index.html'
            ];
            
            for (const page of pages) {
                try {
                    const response = await fetch(page);
                    if (response.ok) {
                        addResult(`✓ ${page} exists and is accessible`, 'success');
                    } else {
                        addResult(`✗ ${page} returned ${response.status}`, 'error');
                    }
                } catch (error) {
                    addResult(`✗ ${page} failed to load: ${error.message}`, 'error');
                }
            }
        }
        
        async function testButtons() {
            clearResults();
            addResult('Testing button functionality...');
            
            // Create a test iframe to load the CRM
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = '/frontend/crm-simple.html';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                try {
                    const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                    
                    // Check for buttons with data-action
                    const actionButtons = iframeDoc.querySelectorAll('[data-action]');
                    addResult(`Found ${actionButtons.length} buttons with data-action attributes`, 'success');
                    
                    // Check for navigation items
                    const navItems = iframeDoc.querySelectorAll('.nav-item[data-page]');
                    addResult(`Found ${navItems.length} navigation items`, 'success');
                    
                    // Check for onclick handlers (should be 0)
                    const onclickElements = iframeDoc.querySelectorAll('[onclick]');
                    if (onclickElements.length === 0) {
                        addResult('✓ No inline onclick handlers found', 'success');
                    } else {
                        addResult(`✗ Found ${onclickElements.length} inline onclick handlers`, 'warning');
                        onclickElements.forEach(el => {
                            console.log('Element with onclick:', el.outerHTML.substring(0, 100));
                        });
                    }
                    
                    // Check if event listeners are set up
                    if (typeof iframe.contentWindow.setupNavigationEventListeners === 'function') {
                        addResult('✓ setupNavigationEventListeners function exists', 'success');
                    } else {
                        addResult('✗ setupNavigationEventListeners function not found', 'error');
                    }
                    
                    if (typeof iframe.contentWindow.setupButtonEventListeners === 'function') {
                        addResult('✓ setupButtonEventListeners function exists', 'success');
                    } else {
                        addResult('✗ setupButtonEventListeners function not found', 'error');
                    }
                    
                } catch (error) {
                    addResult(`Error testing buttons: ${error.message}`, 'error');
                }
                
                document.body.removeChild(iframe);
            };
        }
        
        function testEventHandlers() {
            clearResults();
            addResult('Testing event handler setup...');
            
            // Test if functions exist in the current window
            const requiredFunctions = [
                'connectWhatsApp',
                'checkWhatsAppConnection',
                'sendMessage',
                'loadConversations',
                'selectConversation'
            ];
            
            const iframe = document.createElement('iframe');
            iframe.style.display = 'none';
            iframe.src = '/frontend/crm-simple.html';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                const iframeWindow = iframe.contentWindow;
                
                requiredFunctions.forEach(func => {
                    if (typeof iframeWindow[func] === 'function') {
                        addResult(`✓ ${func} function exists`, 'success');
                    } else {
                        addResult(`✗ ${func} function not found`, 'warning');
                    }
                });
                
                document.body.removeChild(iframe);
            };
        }
        
        function openCRM() {
            window.open('/frontend/crm-simple.html', '_blank');
        }
        
        // Auto-run tests on load
        window.onload = function() {
            testNavigation();
        };
    </script>
</body>
</html>